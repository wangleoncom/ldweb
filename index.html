<!DOCTYPE html>
<html lang="zh-TW" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¹¿ğŸ¦Œçš„ QA æª”æ¡ˆå®¤</title>
    <link rel="icon" href="./images/basic/icon.png" type="image/png">
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#fdf2f8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./images/basic/icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Rounded+Mplus+1c:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="./deer_db.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        deer: { 50: '#fdf2f8', 100: '#fce7f3', 200: '#fbcfe8', 300: '#f9a8d4', 400: '#f472b6', 500: '#ec4899', 600: '#db2777', 800: '#9d174d', 900: '#831843' }
                    },
                    fontFamily: { sans: ['"Rounded Mplus 1c"', '"Noto Sans TC"', 'sans-serif'] },
                    animation: { 'pop-in': 'popIn 0.5s cubic-bezier(0.26, 0.53, 0.74, 1.48) forwards', 'float': 'float 3s ease-in-out infinite' },
                    keyframes: {
                        popIn: { '0%': { opacity: '0', transform: 'scale(0.9) translateY(20px)' }, '100%': { opacity: '1', transform: 'scale(1) translateY(0)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-6px)' } }
                    }
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.4); }
        .dark .glass { background: rgba(30, 30, 30, 0.7); border: 1px solid rgba(255, 255, 255, 0.1); }
        .ios-active:active { transform: scale(0.96); transition: transform 0.1s; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .medal-glow { filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6)); }
    </style>
</head>
<body class="bg-deer-50 text-gray-700 transition-colors duration-300 dark:bg-gray-900 dark:text-gray-100 font-sans min-h-screen selection:bg-deer-300 selection:text-deer-900 overflow-x-hidden"
      x-data="deerApp()" x-init="initApp()" @scroll.window="handleScroll">

    <div class="fixed inset-0 overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-deer-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse transition-transform duration-[3s]" :style="`transform: translateY(${scrollY * 0.2}px)`"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse delay-1000 transition-transform duration-[3s]" :style="`transform: translateY(-${scrollY * 0.1}px)`"></div>
    </div>

    <nav class="fixed top-0 w-full z-50 transition-all duration-500 border-b border-transparent"
         :class="scrollY > 50 ? 'glass shadow-sm border-white/20' : 'bg-transparent'">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center cursor-pointer ios-active transition-transform origin-left duration-300" 
                 @click="changeTab('home')" :class="scrollY > 50 ? 'scale-90' : 'scale-100'">
                <img src="./images/basic/icon.png" class="w-8 h-8 rounded-full mr-2 border border-deer-300 object-cover shadow-sm">
                <span class="font-bold text-xl text-deer-600 dark:text-deer-300 hidden sm:block tracking-wide">é¹¿ QA</span>
            </div>
            
            <div class="flex space-x-1 bg-gray-100/50 dark:bg-gray-800/50 p-1 rounded-full backdrop-blur-sm border border-white/20 overflow-x-auto no-scrollbar">
                <button @click="changeTab('home')" :class="tabClass('home')">é¦–é </button>
                <button @click="changeTab('ai')" :class="tabClass('ai')">AI</button>
                <button @click="startQuizMode()" :class="tabClass('quiz')">æ¸¬é©—</button>
                <button @click="changeTab('idcard')" :class="tabClass('idcard')">èº«åˆ†è­‰</button>
            </div>
            
            <button @click="toggleDarkMode" class="p-2 rounded-full hover:bg-gray-200/50 dark:hover:bg-gray-700/50 ios-active transition-colors">
                <span x-text="isDark ? 'â˜€ï¸' : 'ğŸŒ™'"></span>
            </button>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto min-h-[80vh]">
        
        <div x-show="installPrompt" class="mb-6 mx-auto max-w-lg glass p-4 rounded-xl flex items-center justify-between animate-float border border-deer-200">
            <div class="flex items-center">
                <span class="text-2xl mr-3">ğŸ“²</span>
                <div class="text-xs">
                    <div class="font-bold text-deer-700 dark:text-deer-300">ä¸‹è¼‰ App ç‰ˆæœ¬</div>
                    <div class="text-gray-500">å®‰è£åˆ°æ¡Œé¢ï¼Œé›¢ç·šä¹Ÿèƒ½ç”¨ï¼</div>
                </div>
            </div>
            <button @click="installPWA" class="px-4 py-2 bg-deer-500 text-white rounded-full text-sm font-bold shadow-md ios-active">å®‰è£</button>
        </div>

        <div x-show="currentTab === 'home'" x-transition.opacity.duration.500ms>
            <div class="glass rounded-3xl p-6 mb-8 border-l-4 border-deer-400 flex flex-col md:flex-row items-center gap-6 shadow-xl transform transition duration-100 ease-out origin-top"
                 :style="`opacity: ${Math.max(0, 1 - scrollY / 300)}; transform: scale(${Math.max(0.9, 1 - scrollY / 1000)}) translateY(${scrollY * 0.2}px)`">
                <img src="./images/basic/icon.png" class="w-24 h-24 md:w-32 md:h-32 rounded-full object-cover shadow-lg border-4 border-white dark:border-gray-700 cursor-pointer hover:rotate-12 transition-transform duration-500 ios-active">
                <div class="flex-1 text-center md:text-left">
                    <h2 class="text-3xl font-bold tracking-tight text-gray-800 dark:text-white">é¹¿ (Walking Deer)</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-2 leading-relaxed font-medium">ğŸ‚ 10/03 å¤©ç§¤åº§ | ğŸ“ 170cm | âš–ï¸ 42kg</p>
                    <div class="flex justify-center md:justify-start gap-3 mt-4">
                        <a href="https://www.tiktok.com/@ld.1003_" target="_blank" class="px-5 py-2 bg-black text-white rounded-full text-sm font-bold ios-active shadow-lg">TikTok</a>
                        <a href="https://www.instagram.com/ld.1003_/" target="_blank" class="px-5 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full text-sm font-bold ios-active shadow-lg">Instagram</a>
                    </div>
                </div>
            </div>

            <div class="sticky top-20 z-40 mb-8 transition-all duration-500 ease-out" :class="scrollY > 150 ? 'pt-2 px-2' : ''">
                <div class="relative max-w-2xl mx-auto transition-all duration-500" :class="scrollY > 150 ? 'shadow-2xl scale-[0.98]' : 'shadow-lg'">
                    <div class="absolute inset-0 rounded-full bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl transition-all duration-500" :class="scrollY > 150 ? 'opacity-100' : 'opacity-80'"></div>
                    <input type="text" x-model="search" @input="currentPage = 1" placeholder="æœå°‹å•é¡Œ... (ä¾‹å¦‚: é¹¿ ç”·å‹)" class="relative w-full pl-14 pr-6 py-4 rounded-full bg-transparent border-2 border-transparent focus:border-deer-300 focus:ring-0 text-lg transition-all placeholder-gray-400 dark:text-white" :class="scrollY > 150 ? 'py-3 text-base' : 'py-4 text-lg'">
                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-2xl transition-all duration-500" :class="scrollY > 150 ? 'text-xl text-deer-500' : 'text-gray-400'">ğŸ”</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 min-h-[400px]">
                <template x-for="(item, index) in paginatedData" :key="item.id">
                    <div class="group h-64 perspective-1000 cursor-pointer animate-pop-in" :style="`animation-delay: ${index * 50}ms`" @click="toggleCard(item.id)">
                        <div class="relative w-full h-full transform-style-3d transition-all duration-700 shadow-xl hover:shadow-2xl rounded-3xl ios-active" :class="{ 'rotate-y-180': flippedCards.includes(item.id) }">
                            <div class="absolute w-full h-full glass rounded-3xl p-6 flex flex-col justify-between backface-hidden border-t-4 border-deer-300 bg-gradient-to-b from-white/60 to-white/30 dark:from-gray-800/60 dark:to-gray-900/30">
                                <div>
                                    <span class="text-xs font-black text-deer-500 bg-deer-100 dark:bg-deer-900/50 px-3 py-1 rounded-full">Q.<span x-text="item.id"></span></span>
                                    <h3 class="text-lg font-bold mt-3 leading-snug text-gray-800 dark:text-gray-100" x-text="item.q"></h3>
                                    <span x-show="search.length > 0 && item.score > 0" class="text-xs text-pink-500 font-mono mt-2 block bg-pink-50 dark:bg-pink-900/30 w-fit px-2 py-0.5 rounded">Match Score: <span x-text="item.score"></span></span>
                                </div>
                                <div class="flex justify-end items-center text-sm text-gray-400 font-medium">é»æ“Šç¿»ç‰Œ ğŸ‘‰</div>
                            </div>
                            <div class="absolute w-full h-full glass rounded-3xl p-6 flex flex-col backface-hidden rotate-y-180 bg-white dark:bg-gray-800 border-b-4 border-purple-400 overflow-y-auto">
                                <div class="flex-1 flex items-center justify-center"><p class="text-lg font-medium text-center leading-relaxed text-gray-700 dark:text-gray-200" x-text="item.a"></p></div>
                                <button @click.stop="openShareModal(item)" class="w-full mt-4 flex justify-center items-center gap-2 text-xs text-deer-600 bg-deer-50 dark:bg-deer-900/30 px-4 py-2 rounded-xl font-bold hover:bg-deer-100 transition-colors ios-active">ğŸ“¸ ç”Ÿæˆ IG å¡ç‰‡</button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
            
            <div class="flex flex-wrap justify-center items-center mt-12 gap-3 pb-12" x-show="totalPages > 1">
                <button @click="prevPage" :disabled="currentPage === 1" class="px-5 py-2 rounded-full glass font-bold hover:bg-deer-100 disabled:opacity-30 transition ios-active">â—€</button>
                <span class="font-black text-deer-600 dark:text-deer-300 px-3 text-lg"><span x-text="currentPage"></span> / <span x-text="totalPages"></span></span>
                <button @click="nextPage" :disabled="currentPage === totalPages" class="px-5 py-2 rounded-full glass font-bold hover:bg-deer-100 disabled:opacity-30 transition ios-active">â–¶</button>
            </div>
        </div>

        <div x-show="currentTab === 'ai'" x-cloak class="max-w-2xl mx-auto h-[75vh] flex flex-col glass rounded-3xl overflow-hidden shadow-2xl relative border border-white/40">
            <div class="bg-white/50 dark:bg-black/30 backdrop-blur-md p-4 flex items-center border-b border-gray-200/50 dark:border-gray-700/50">
                <img src="./images/basic/AI.png" class="w-10 h-10 rounded-full object-cover mr-3 bg-white p-0.5 shadow-md">
                <div><h3 class="font-bold text-gray-800 dark:text-gray-100">AI å°éº‹é¹¿</h3><div class="text-xs text-green-500 animate-pulse">â— ç·šä¸Š</div></div>
            </div>
            <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chatContainer">
                <template x-for="msg in chatHistory" :key="msg.id">
                    <div class="flex w-full animate-pop-in" :class="msg.isUser ? 'justify-end' : 'justify-start'">
                        <div class="max-w-[80%] rounded-2xl px-5 py-3 shadow-md text-sm leading-relaxed" :class="msg.isUser ? 'bg-gradient-to-br from-deer-500 to-pink-600 text-white rounded-br-none' : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-bl-none'"><p x-text="msg.text" class="whitespace-pre-line"></p></div>
                    </div>
                </template>
            </div>
            <div class="p-4 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700">
                <form @submit.prevent="sendMessage" class="flex gap-2">
                    <input type="text" x-model="chatInput" placeholder="è¼¸å…¥å•é¡Œ..." class="flex-1 rounded-full bg-gray-100 dark:bg-gray-800 border-transparent focus:border-deer-400 px-5 py-3 transition-all">
                    <button type="submit" class="bg-deer-500 hover:bg-deer-600 text-white rounded-full p-3 w-12 h-12 flex items-center justify-center transition-all shadow-lg ios-active">â¤</button>
                </form>
            </div>
        </div>

        <div x-show="currentTab === 'quiz'" x-cloak class="max-w-2xl mx-auto">
            <div x-show="!quizStarted && !quizEnded" class="text-center py-12 glass rounded-3xl p-10 shadow-2xl animate-pop-in">
                <div class="text-8xl mb-6 animate-bounce filter drop-shadow-lg">ğŸ“</div>
                <h2 class="text-3xl font-black mb-4 text-gray-800 dark:text-white">éº‹é¹¿å¤§æœƒè€ƒ</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-8 font-medium">å…¨å°å¯ç²å¾—<span class="text-yellow-500 font-bold">é‡‘ç‰Œå‹³ç« </span>ï¼</p>
                <button @click="startQuiz" class="px-10 py-4 bg-gradient-to-r from-deer-400 to-purple-500 text-white rounded-full font-bold text-xl shadow-lg ios-active">æŒ‘æˆ°é–‹å§‹</button>
            </div>
            <div x-show="quizStarted && !quizEnded" class="animate-pop-in">
                <div class="flex justify-between items-center mb-6 px-2">
                    <span class="font-bold text-deer-600 bg-deer-100 px-3 py-1 rounded-full text-sm">Q.<span x-text="currentQuizIndex + 1"></span>/5</span>
                    <span class="text-sm font-bold bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-full">åˆ†: <span x-text="quizScore"></span></span>
                </div>
                <div class="glass rounded-3xl p-8 mb-6 border-l-4 border-deer-400 min-h-[180px] flex items-center justify-center relative shadow-lg">
                    <h3 class="text-2xl font-bold text-center leading-relaxed text-gray-800 dark:text-white" x-text="currentQuestion?.q"></h3>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <template x-for="(opt, idx) in currentOptions" :key="idx">
                        <button @click="checkAnswer(opt)" :disabled="hasAnswered" :class="getOptionClass(opt)" class="w-full p-5 rounded-2xl text-left font-bold transition-all border-2 shadow-sm flex items-center justify-between group">
                            <div class="flex items-center"><span class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-sm mr-4" x-text="['A','B','C','D'][idx]"></span><span x-text="opt"></span></div>
                            <span x-show="hasAnswered && opt === currentCorrectText" class="text-green-600 text-xl">âœ…</span>
                            <span x-show="hasAnswered && opt !== currentCorrectText && selectedOption === opt" class="text-red-500 text-xl">âŒ</span>
                        </button>
                    </template>
                </div>
                <button x-show="hasAnswered" @click="nextQuestion" class="mt-8 w-full py-4 bg-gray-800 dark:bg-gray-700 text-white rounded-2xl font-bold shadow-lg ios-active">ä¸‹ä¸€é¡Œ âœ</button>
            </div>
            <div x-show="quizEnded" class="text-center py-12 glass rounded-3xl p-10 shadow-2xl relative overflow-hidden animate-pop-in">
                <div x-show="quizScore === 5" class="mb-6 relative z-10">
                    <img src="./images/basic/medal.png" class="w-56 h-56 mx-auto object-contain animate-bounce medal-glow">
                    <div class="text-3xl font-black text-yellow-600 mt-6">æ­å–œç²å¾—é‡‘ç‰Œï¼</div>
                </div>
                <div x-show="quizScore < 5" class="text-8xl mb-6"><span x-text="quizScore >= 3 ? 'ğŸ¥ˆ' : 'ğŸ¤¡'"></span></div>
                <h2 class="text-5xl font-black text-gray-800 dark:text-white mb-2">å¾—åˆ†ï¼š<span x-text="quizScore * 20" class="text-deer-500"></span></h2>
                <div class="flex gap-4 justify-center mt-10">
                    <button @click="startQuiz" class="px-8 py-3 bg-gray-200 dark:bg-gray-700 rounded-full font-bold ios-active">å†æ¸¬ä¸€æ¬¡</button>
                </div>
            </div>
        </div>

        <div x-show="currentTab === 'idcard'" x-cloak class="max-w-2xl mx-auto">
            <div class="glass rounded-3xl p-8 shadow-2xl animate-pop-in">
                <h2 class="text-3xl font-black mb-6 text-center text-deer-600 dark:text-deer-300">éº‹é¹¿èªè­‰ä¸­å¿ƒ ğŸªª</h2>
                
                <div class="space-y-4 mb-8">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">ä½ çš„æš±ç¨± / åå­—</label>
                        <input type="text" x-model="idCardName" placeholder="ä¾‹å¦‚ï¼šå°é¹¿ç²‰" class="w-full px-4 py-3 rounded-xl bg-white/50 border border-gray-200 focus:border-deer-400 focus:ring-0">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">é¸æ“‡å¡ç‰‡èƒŒæ™¯</label>
                        <div class="grid grid-cols-3 gap-2">
                            <template x-for="(bg, index) in backgrounds" :key="index">
                                <div @click="selectedBg = bg" class="aspect-[3/4] rounded-lg overflow-hidden cursor-pointer border-4 transition-all" :class="selectedBg === bg ? 'border-deer-500 scale-95' : 'border-transparent'">
                                    <img :src="bg" class="w-full h-full object-cover">
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <button @click="generateIDCard" class="w-full py-4 bg-gradient-to-r from-deer-500 to-pink-600 text-white rounded-2xl font-bold shadow-lg ios-active text-lg">ç”Ÿæˆæˆ‘çš„èº«åˆ†è­‰ âœ¨</button>
            </div>
        </div>

        <div id="shareCardTemplate" class="fixed top-0 left-[-9999px] w-[320px] h-[500px] flex flex-col items-center justify-center text-center rounded-xl overflow-hidden relative">
            <img :src="randomShareBg" class="absolute inset-0 w-full h-full object-cover z-0">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-[2px] z-10"></div>
            
            <div class="relative z-20 w-full h-full p-6 flex flex-col items-center justify-center">
                <div class="w-20 h-20 rounded-full overflow-hidden border-2 border-white shadow-lg mb-4">
                    <img src="./images/basic/icon.png" class="w-full h-full object-cover">
                </div>
                <div class="bg-white/90 p-5 rounded-2xl w-full shadow-2xl backdrop-blur-sm">
                    <span class="text-xs font-bold text-deer-500 uppercase tracking-widest mb-1 block">Question</span>
                    <p id="shareCardQ" class="font-black text-gray-800 mb-3 text-lg leading-snug"></p>
                    <div class="w-full h-[1px] bg-gray-200 my-2"></div>
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1 block">Answer</span>
                    <p id="shareCardA" class="text-deer-600 font-bold text-xl"></p>
                </div>
                <div class="mt-6 text-white text-xs font-mono opacity-80 border border-white/30 px-3 py-1 rounded-full">
                    deer-qa-system.github.io
                </div>
            </div>
        </div>

        <div id="idCardTemplate" class="fixed top-0 left-[-9999px] w-[320px] h-[500px] flex flex-col items-center justify-between text-center rounded-xl overflow-hidden relative font-sans">
            <img :src="selectedBg" class="absolute inset-0 w-full h-full object-cover z-0">
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-black/30 z-10"></div>
            
            <div class="relative z-20 w-full p-6 flex justify-between items-start">
                <img src="./images/basic/icon.png" class="w-12 h-12 rounded-full border-2 border-white">
                <div class="text-right text-white">
                    <div class="text-xs opacity-80">OFFICIAL FAN</div>
                    <div class="font-bold text-lg tracking-widest">éº‹é¹¿èªè­‰</div>
                </div>
            </div>

            <div class="relative z-20 w-full p-6 text-left text-white">
                <div class="mb-4">
                    <div class="text-[10px] uppercase opacity-70 tracking-widest">Name</div>
                    <div class="text-3xl font-black" x-text="idCardName"></div>
                </div>
                <div class="flex justify-between items-end">
                    <div>
                        <div class="text-[10px] uppercase opacity-70 tracking-widest">ID Number</div>
                        <div class="text-xl font-mono" x-text="generatedIdNumber"></div>
                    </div>
                    <div>
                        <div class="text-[10px] uppercase opacity-70 tracking-widest text-right">Date</div>
                        <div class="text-sm font-mono" x-text="new Date().toISOString().split('T')[0]"></div>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="showShareModal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 p-6 backdrop-blur-sm" x-cloak x-transition.opacity>
            <div class="bg-white rounded-3xl p-6 max-w-sm w-full flex flex-col items-center animate-pop-in">
                <h3 class="font-bold text-gray-800 mb-4 text-lg">é•·æŒ‰åœ–ç‰‡å„²å­˜åˆ†äº« ğŸ“¸</h3>
                <div id="shareResultContainer" class="mb-6 shadow-2xl rounded-xl overflow-hidden border-4 border-gray-100 w-full"></div>
                <button @click="showShareModal = false" class="px-8 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full font-bold text-sm transition-colors ios-active">é—œé–‰</button>
            </div>
        </div>

        <div x-show="showToast" x-transition class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-black/80 backdrop-blur text-white px-6 py-3 rounded-full text-sm z-50 shadow-xl font-bold flex items-center"><span class="mr-2">âœ…</span> <span x-text="toastMessage"></span></div>
    </main>

    <footer class="text-center py-10 text-gray-400 text-sm font-medium"><p>Â© 2025 é¹¿ğŸ¦Œçš„ QA æª”æ¡ˆå®¤</p></footer>

    <script>
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js')); }

        function deerApp() {
            return {
                allData: window.DEER_QA || [],
                search: '',
                currentTab: 'home',
                isDark: false,
                flippedCards: [],
                showToast: false,
                toastMessage: '',
                scrollY: 0,
                
                installPrompt: null,
                
                // åœ–ç‰‡è·¯å¾‘è¨­å®š (å¦‚æœè¦åŠ æ›´å¤šèƒŒæ™¯åœ–ï¼ŒåŠ åœ¨é€™è£¡)
                backgrounds: [
                    './images/backgrounds/bg1.jpg',
                    './images/backgrounds/bg2.jpg',
                    './images/backgrounds/bg3.jpg'
                ],
                
                // èº«åˆ†è­‰
                idCardName: '',
                selectedBg: './images/backgrounds/bg1.jpg',
                generatedIdNumber: '',
                
                // åˆ†äº«å¡ç‰‡
                showShareModal: false,
                randomShareBg: '',

                currentPage: 1,
                itemsPerPage: 30,
                
                // AI
                chatInput: '', chatHistory: [], isTyping: false,
                
                // æ¸¬é©—
                quizStarted: false, quizEnded: false, quizData: [], currentQuizIndex: 0, currentOptions: [], hasAnswered: false, selectedOption: null, quizScore: 0, currentCorrectText: '',

                initApp() {
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) this.toggleDarkMode();
                    window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); this.installPrompt = e; });
                },

                handleScroll() { this.scrollY = window.scrollY; },

                // ç”Ÿæˆèº«åˆ†è­‰
                generateIDCard() {
                    if (!this.idCardName) { this.showNotification("è«‹è¼¸å…¥åå­—ï¼"); return; }
                    this.generatedIdNumber = 'DEER-' + Math.floor(1000 + Math.random() * 9000);
                    
                    const el = document.getElementById('idCardTemplate');
                    this.showShareModal = true;
                    document.getElementById('shareResultContainer').innerHTML = '<div class="p-8 text-center text-gray-400">ç”Ÿæˆä¸­...</div>';

                    // å»¶é²ä»¥ç¢ºä¿ DOM æ¸²æŸ“
                    setTimeout(() => {
                        html2canvas(el, { backgroundColor: null, useCORS: true, scale: 2 }).then(canvas => {
                            const container = document.getElementById('shareResultContainer');
                            container.innerHTML = '';
                            canvas.style.width = '100%';
                            canvas.style.height = 'auto';
                            container.appendChild(canvas);
                        });
                    }, 500);
                },

                // ç”Ÿæˆåˆ†äº«å¡ç‰‡ (ä½¿ç”¨éš¨æ©ŸèƒŒæ™¯)
                openShareModal(item) {
                    this.randomShareBg = this.backgrounds[Math.floor(Math.random() * this.backgrounds.length)];
                    document.getElementById('shareCardId').innerText = item.id;
                    document.getElementById('shareCardQ').innerText = item.q;
                    document.getElementById('shareCardA').innerText = item.short || item.a;
                    
                    const el = document.getElementById('shareCardTemplate');
                    this.showShareModal = true;
                    document.getElementById('shareResultContainer').innerHTML = '<div class="p-8 text-center text-gray-400">ç”Ÿæˆä¸­...</div>';

                    setTimeout(() => {
                        html2canvas(el, { backgroundColor: null, useCORS: true, scale: 2 }).then(canvas => {
                            const container = document.getElementById('shareResultContainer');
                            container.innerHTML = '';
                            canvas.style.width = '100%';
                            canvas.style.height = 'auto';
                            container.appendChild(canvas);
                        });
                    }, 500);
                },

                async installPWA() { if (this.installPrompt) { this.installPrompt.prompt(); const { outcome } = await this.installPrompt.userChoice; if (outcome === 'accepted') this.installPrompt = null; } },
                
                // ç°¡åŒ–å¾Œçš„é‚è¼¯ (ä¿æŒåŸæœ‰åŠŸèƒ½)
                get filteredQuestions() { if (!this.allData) return []; if (this.search.trim() === '') return this.allData; const s = this.search.toLowerCase(); return this.allData.filter(i => i.q.toLowerCase().includes(s) || i.a.toLowerCase().includes(s)); },
                get paginatedData() { const start = (this.currentPage - 1) * this.itemsPerPage; return this.filteredQuestions.slice(start, start + this.itemsPerPage); },
                get totalPages() { return Math.ceil(this.filteredQuestions.length / this.itemsPerPage); },
                nextPage() { if (this.currentPage < this.totalPages) this.currentPage++; window.scrollTo(0,0); },
                prevPage() { if (this.currentPage > 1) this.currentPage--; window.scrollTo(0,0); },
                changeTab(tab) { this.currentTab = tab; window.scrollTo(0,0); },
                toggleDarkMode() { this.isDark = !this.isDark; document.documentElement.classList.toggle('dark', this.isDark); },
                toggleCard(id) { if (this.flippedCards.includes(id)) this.flippedCards = this.flippedCards.filter(cid => cid !== id); else this.flippedCards.push(id); },
                showNotification(msg) { this.toastMessage = msg; this.showToast = true; setTimeout(() => this.showToast = false, 3000); },
                tabClass(tab) { const active = "bg-white text-deer-600 shadow-md font-bold"; const inactive = "text-gray-500 hover:text-gray-700"; return `px-4 py-1.5 rounded-full text-sm transition-all whitespace-nowrap ${this.currentTab === tab ? active : inactive}`; },
                
                // AI
                sendMessage() { if(!this.chatInput) return; this.chatHistory.push({id: Date.now(), text: this.chatInput, isUser: true, time: 'Now'}); this.chatInput = ''; this.isTyping = true; setTimeout(() => { this.isTyping = false; this.chatHistory.push({id: Date.now(), text: 'æˆ‘æ˜¯ AI å°éº‹é¹¿ï¼', isUser: false, time: 'Now'}); }, 1000); },

                // æ¸¬é©— (ç°¡åŒ–ç‰ˆ)
                startQuizMode() { this.changeTab('quiz'); },
                startQuiz() { this.quizStarted = true; this.quizEnded = false; this.currentQuizIndex = 0; this.quizScore = 0; this.prepareQuestion(); },
                prepareQuestion() { this.hasAnswered = false; this.currentCorrectText = this.currentQuestion.short || this.currentQuestion.a; this.currentOptions = [this.currentCorrectText, 'éŒ¯èª¤é¸é …1', 'éŒ¯èª¤é¸é …2', 'éŒ¯èª¤é¸é …3'].sort(() => 0.5 - Math.random()); },
                get currentQuestion() { return this.allData[this.currentQuizIndex]; }, // é€™è£¡åƒ…ç‚ºç¯„ä¾‹ï¼Œéœ€é…åˆå®Œæ•´é‚è¼¯
                checkAnswer(opt) { this.hasAnswered = true; this.selectedOption = opt; if(opt === this.currentCorrectText) this.quizScore++; },
                nextQuestion() { if(this.currentQuizIndex < 4) { this.currentQuizIndex++; this.prepareQuestion(); } else { this.quizEnded = true; } },
                shareResult() { /* ... */ }
            }
        }
    </script>
</body>
</html>