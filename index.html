<!DOCTYPE html>
<html lang="zh-TW" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é¹¿ğŸ¦Œçš„QAç¶²ç«™ (2026 å…¨æ–°ä»‹é¢)</title>
    <link rel="icon" href="./images/basic/icon.png" type="image/png">
    <meta name="theme-color" content="#fce7f3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Rounded+Mplus+1c:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script src="./deer_db.js"></script>
    <script src="./quiz_db.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['"Rounded Mplus 1c"', '"Noto Sans TC"', 'sans-serif'] },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        blob: {
                            "0%": { transform: "translate(0px, 0px) scale(1)" },
                            "33%": { transform: "translate(30px, -50px) scale(1.1)" },
                            "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
                            "100%": { transform: "translate(0px, 0px) scale(1)" }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Rounded Mplus 1c', sans-serif;
            background-color: #fdf2f8;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .liquid-bg {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1;
            background: linear-gradient(135deg, #fce7f3 0%, #e0e7ff 100%);
            overflow: hidden;
        }
        .liquid-blob {
            position: absolute;
            filter: blur(80px);
            opacity: 0.6;
            animation: blob 10s infinite alternate;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
        }
        
        .glass-nav {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(25px) saturate(200%);
            -webkit-backdrop-filter: blur(25px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* è‡ªå®šç¾©å·è»¸æ¨£å¼ (QA å¡ç‰‡èƒŒé¢ç”¨) */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #fbcfe8; border-radius: 20px; }

        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="text-gray-800 pb-32 transition-colors duration-500"
      x-data="deerApp()" x-init="initApp()"
      @scroll.window="handleScroll">

    <div x-show="isGenerating" 
         class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white/60 backdrop-blur-xl transition-opacity duration-300"
         x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
         x-cloak>
        <div class="w-16 h-16 border-4 border-pink-200 border-t-pink-500 rounded-full animate-spin mb-4"></div>
        <div class="text-pink-600 font-bold text-lg animate-pulse">æ­£åœ¨å°è£½ä¸­...</div>
    </div>

    <div class="liquid-bg">
        <div class="liquid-blob bg-pink-300 w-96 h-96 rounded-full top-[-10%] left-[-10%]"></div>
        <div class="liquid-blob bg-purple-300 w-80 h-80 rounded-full top-[40%] right-[-10%] animation-delay-2000"></div>
        <div class="liquid-blob bg-blue-300 w-80 h-80 rounded-full bottom-[-10%] left-[20%] animation-delay-4000"></div>
    </div>

    <nav class="fixed top-0 w-full z-40 transition-all duration-300 border-b border-transparent"
         :class="scrollY > 20 ? 'glass-nav py-2' : 'bg-transparent py-4'">
        <div class="max-w-6xl mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer transition-transform hover:scale-105 active:scale-95" @click="changeTab('home'); playSound('click')">
                <img src="./images/basic/icon.png" class="w-10 h-10 rounded-full border-2 border-white shadow-md object-cover">
                <span class="font-black text-2xl text-gray-800 tracking-tight">é¹¿ QA</span>
            </div>
        </div>
    </nav>

    <div class="fixed bottom-6 left-0 right-0 z-40 flex justify-center px-4 safe-area-bottom pointer-events-none">
        <nav class="pointer-events-auto flex items-center gap-2 p-2 rounded-[2rem] glass-nav shadow-2xl overflow-x-auto no-scrollbar max-w-full">
            <template x-for="tab in tabs" :key="tab.id">
                <button @click="changeTab(tab.id); playSound('click')"
                        class="relative px-6 py-3 rounded-[1.5rem] text-sm font-bold transition-all duration-300 whitespace-nowrap flex-shrink-0"
                        :class="currentTab === tab.id 
                            ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow-lg scale-105' 
                            : 'text-gray-500 hover:bg-white/50 hover:text-gray-800'">
                    <span x-text="tab.label"></span>
                </button>
            </template>
        </nav>
    </div>

    <main class="pt-28 px-4 max-w-3xl mx-auto min-h-screen">

        <div x-show="currentTab === 'home'" x-transition:enter="transition ease-out duration-500" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
            <div class="glass-panel rounded-[32px] p-8 mb-8 relative overflow-hidden group">
                <div class="absolute top-0 right-0 w-32 h-32 bg-pink-400/20 rounded-full blur-2xl -mr-10 -mt-10"></div>
                
                <div class="flex flex-col sm:flex-row items-center gap-6 relative z-10">
                    <div class="relative flex-shrink-0">
                        <img src="./images/basic/icon.png" class="w-28 h-28 rounded-full border-4 border-white shadow-xl object-cover transform transition-transform group-hover:scale-105 duration-500">
                        <div class="absolute bottom-0 right-0 bg-green-400 w-6 h-6 rounded-full border-4 border-white"></div>
                    </div>
                    
                    <div class="text-center sm:text-left flex-1">
                        <div class="flex items-center justify-center sm:justify-start gap-2 mb-2">
                             <h2 class="text-4xl font-black text-gray-800 tracking-tight">é¹¿ğŸ¦Œ</h2>
                        </div>
                        
                        <p class="text-gray-600 font-medium leading-relaxed mb-4">
                            ğŸ‚ 10/03 å¤©ç§¤åº§ï½œğŸ“ 170cmï½œâš–ï¸ 42kg<br>
                            ğŸˆ è²“å’ªï¼šå“ºåš• (è‹±åœ‹çŸ­æ¯›è²“)
                        </p>
                        
                        <div class="flex justify-center sm:justify-start gap-3">
                            <a href="https://www.tiktok.com/@ld.1003_" target="_blank" class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 hover:bg-black hover:text-white transition-all duration-300 group/btn">
                                <span class="text-sm font-bold">TikTok</span>
                            </a>
                            <a href="https://www.instagram.com/ld.1003_/" target="_blank" class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 hover:bg-gradient-to-tr hover:from-yellow-400 hover:via-red-500 hover:to-purple-600 hover:text-white transition-all duration-300 group/btn">
                                <span class="text-sm font-bold">Instagram</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="relative mb-8 group">
                <div class="absolute inset-0 bg-white/40 rounded-2xl blur-md group-hover:bg-white/60 transition-colors"></div>
                <input type="text" x-model="search" @input="filterQA" placeholder="ğŸ” æœå°‹å•é¡Œ... (ä¾‹å¦‚: èº«é«˜)" 
                       class="relative w-full px-6 py-4 rounded-2xl bg-white/50 border border-white/50 focus:border-pink-400 focus:ring-2 focus:ring-pink-200 outline-none transition-all text-lg placeholder-gray-400 text-gray-800 backdrop-blur-sm">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 pb-6">
                <template x-for="item in paginatedData" :key="item.id">
                    <div class="group h-48 perspective-1000 cursor-pointer" @click="toggleCard(item.id); playSound('flip')">
                        <div class="relative w-full h-full transform-style-3d transition-transform duration-700 shadow-xl hover:shadow-2xl rounded-[24px]"
                             :class="{ 'rotate-y-180': flippedCards.includes(item.id) }">
                            
                            <div class="absolute w-full h-full glass-panel rounded-[24px] p-6 flex flex-col justify-between backface-hidden border-t border-white/80">
                                <div>
                                    <span class="inline-block px-2 py-1 bg-pink-100 text-pink-600 text-xs font-bold rounded-md mb-2">Q.</span>
                                    <h3 class="text-lg font-bold text-gray-800 leading-snug line-clamp-3" x-text="item.q"></h3>
                                </div>
                                <div class="text-right text-xs text-gray-400 font-bold uppercase tracking-wider flex items-center justify-end gap-1">
                                    é»æ“Šç¿»è½‰ <span>â†º</span>
                                </div>
                            </div>

                            <div class="absolute w-full h-full glass-panel rounded-[24px] p-5 flex flex-col justify-between items-center backface-hidden rotate-y-180 bg-white/90 border border-pink-200">
                                <div class="w-full max-h-[110px] overflow-y-auto custom-scrollbar pr-1">
                                    <p class="text-base font-medium text-center text-gray-700 leading-relaxed whitespace-pre-wrap" x-text="item.a"></p>
                                </div>
                                <button @click.stop="openShareModal(item); playSound('click')" class="mt-2 px-4 py-2 bg-gray-100 rounded-full text-xs font-bold text-gray-500 hover:bg-pink-100 hover:text-pink-600 transition-colors flex-shrink-0">
                                    ğŸ“¸ åˆ†äº« QA å¡ç‰‡
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
            
            <div x-show="hasMoreData" class="flex justify-center pb-20">
                <button @click="loadMoreQA; playSound('click')" class="px-8 py-3 bg-white/50 hover:bg-pink-100 text-pink-600 rounded-full font-bold shadow-sm transition-all flex items-center gap-2">
                    <span>â¬‡ï¸</span> è¼‰å…¥æ›´å¤š QA
                </button>
            </div>
            <div x-show="!hasMoreData && paginatedData.length > 0" class="text-center text-gray-400 text-xs pb-20 font-bold tracking-widest uppercase">
                --- å·²ç¶“åˆ°åº•å›‰ ---
            </div>
        </div>

        <div x-show="currentTab === 'ai'" x-cloak class="h-[75vh] flex flex-col glass-panel rounded-[32px] overflow-hidden shadow-2xl relative border border-white/50"
             x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100">
            
            <div class="bg-white/60 backdrop-blur-md p-4 border-b border-white/30 flex items-center gap-3 z-10">
                <div class="relative">
                    <img src="./images/basic/AI.png" class="w-10 h-10 rounded-full object-cover border border-white shadow-sm">
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-white animate-pulse"></div>
                </div>
                <div>
                    <h3 class="font-bold text-gray-800">AI éº‹é¹¿</h3>
                    <div class="text-xs text-gray-500">2026 äººå·¥æ™ºæ…§æ¨¡å‹ãƒ»åœ¨ç·šä¸­</div>
                </div>
            </div>

            <div id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-4 bg-white/30 custom-scrollbar">
                <template x-for="msg in chatHistory" :key="msg.id">
                    <div class="flex w-full animate-float" :class="msg.isUser ? 'justify-end' : 'justify-start'">
                        <div class="max-w-[85%] px-5 py-3 rounded-2xl shadow-sm text-[15px] leading-relaxed relative group cursor-pointer transition-all hover:-translate-y-1"
                             @click="!msg.isUser && openMsgDetail(msg)"
                             :class="msg.isUser ? 'bg-gradient-to-br from-pink-500 to-rose-500 text-white rounded-br-none' : 'bg-white/90 text-gray-800 rounded-bl-none border border-white/50'">
                            <p x-text="msg.text" class="whitespace-pre-line"></p>
                            <div x-show="!msg.isUser && msg.accuracy !== undefined" class="text-[10px] opacity-50 mt-1 text-right flex items-center justify-end gap-1 border-t border-gray-200/50 pt-1">
                                <span>â„¹ï¸ é»æ“ŠæŸ¥çœ‹åˆ†æ</span>
                            </div>
                        </div>
                    </div>
                </template>
                <div x-show="isTyping" class="flex justify-start">
                    <div class="bg-white/80 px-4 py-3 rounded-2xl rounded-bl-none flex gap-1 shadow-sm">
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"></div>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-white/70 backdrop-blur-md border-t border-white/30 z-10">
                <div class="flex gap-2">
                    <input type="text" x-model="chatInput" @keydown.enter="handleEnter($event)" 
                           placeholder="è¼¸å…¥å•é¡Œï¼ŒæŒ‰ Enter ç™¼é€..." 
                           class="flex-1 px-5 py-3 rounded-full bg-white border-none focus:ring-2 focus:ring-pink-300 shadow-inner text-gray-700 placeholder-gray-400 transition-all">
                    <button @click="sendMessage" class="bg-gray-900 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:bg-pink-600 transition-colors active:scale-90">
                        â¤
                    </button>
                </div>
            </div>
        </div>

        <div x-show="currentTab === 'quiz'" x-cloak class="max-w-2xl mx-auto" x-transition:enter="transition ease-out duration-500">
            <div x-show="!quizStarted && !quizEnded" class="text-center py-12 glass-panel rounded-[40px] p-8 shadow-2xl relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-pink-400 to-purple-500"></div>
                <div class="text-7xl mb-6 animate-bounce">ğŸ“</div>
                <h2 class="text-4xl font-black text-gray-800 mb-4 tracking-tight">éº‹é¹¿å¤§æœƒè€ƒ 2.0</h2>
                <div class="max-w-xs mx-auto mb-8">
                    <label class="block text-left text-xs font-bold text-gray-500 mb-2 uppercase ml-4">è€ƒç”Ÿå§“å</label>
                    <input type="text" x-model="quizTakerName" placeholder="è¼¸å…¥åå­—é–‹å§‹..." 
                           class="w-full px-6 py-4 rounded-2xl bg-white/50 border-2 border-white/50 focus:border-pink-400 focus:ring-4 focus:ring-pink-100 text-center text-xl font-bold transition-all outline-none">
                </div>
                <button @click="startQuiz" class="w-full max-w-xs px-12 py-4 bg-gradient-to-r from-pink-600 to-purple-600 text-white rounded-2xl font-black text-xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300 active:scale-95 flex items-center justify-center mx-auto">
                    é–‹å§‹æŒ‘æˆ° âœ
                </button>
            </div>

            <div x-show="quizStarted && !quizEnded" class="glass-panel rounded-[32px] p-6 shadow-xl border border-white/60">
                <div class="flex justify-between items-center mb-6">
                    <span class="bg-gray-900 text-white px-3 py-1 rounded-lg text-xs font-bold tracking-widest">Q.<span x-text="currentQuizIndex + 1"></span></span>
                    <div class="h-2 w-32 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-pink-500 transition-all duration-500" :style="`width: ${(currentQuizIndex / 5) * 100}%`"></div>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-center text-gray-800 mb-8 min-h-[80px] flex items-center justify-center" x-text="currentQuestion?.q"></h3>
                <div class="grid gap-3">
                    <template x-for="(opt, idx) in currentOptions" :key="idx">
                        <button @click="checkAnswer(opt); playSound('click')" :disabled="hasAnswered"
                                class="w-full p-5 rounded-2xl text-left font-bold transition-all border-2 flex items-center group relative overflow-hidden"
                                :class="hasAnswered 
                                    ? (opt === currentQuestion.a ? 'bg-green-100 border-green-400 text-green-800' : (selectedOption === opt ? 'bg-red-100 border-red-400 text-red-800' : 'bg-gray-50 border-transparent opacity-50'))
                                    : 'bg-white border-white hover:border-pink-300 hover:bg-pink-50 text-gray-700 shadow-sm hover:shadow-md'">
                            <span class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs mr-4 group-hover:bg-white transition-colors" x-text="['A','B','C','D'][idx]"></span>
                            <span x-text="opt"></span>
                        </button>
                    </template>
                </div>
                <button x-show="hasAnswered" @click="nextQuestion; playSound('click')" class="mt-8 w-full py-4 bg-gray-900 text-white rounded-2xl font-bold shadow-lg hover:bg-gray-700 transition-all active:scale-95">
                    <span x-text="currentQuizIndex === 4 ? 'æŸ¥çœ‹æˆç¸¾å–®' : 'ä¸‹ä¸€é¡Œ'"></span> âœ
                </button>
            </div>
        </div>

        <div x-show="currentTab === 'idcard'" x-cloak class="glass-panel rounded-[40px] p-8 shadow-2xl text-center max-w-md mx-auto">
            <h2 class="text-3xl font-black mb-8 text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-600">éº‹é¹¿èªè­‰ä¸­å¿ƒ</h2>
            <div class="space-y-6 mb-8 text-left">
                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-2 uppercase tracking-wider pl-2">ä½ çš„æš±ç¨±</label>
                    <input type="text" x-model="idCardName" placeholder="è¼¸å…¥æš±ç¨±..." class="w-full px-5 py-4 rounded-2xl bg-white/60 border border-white/50 focus:border-pink-400 outline-none transition-all font-bold text-lg">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-2 uppercase tracking-wider pl-2">é¸æ“‡èƒŒæ™¯</label>
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <template x-for="(bg, index) in displayedBackgrounds" :key="index">
                            <div @click="selectedBg = bg; playSound('click')" 
                                 class="aspect-[3/4] rounded-xl overflow-hidden cursor-pointer border-4 transition-all shadow-sm hover:shadow-md relative bg-gray-100"
                                 :class="selectedBg === bg ? 'border-pink-500 scale-95 ring-2 ring-pink-200' : 'border-white opacity-80 hover:opacity-100'">
                                <img :src="bg" class="w-full h-full object-cover">
                            </div>
                        </template>
                    </div>
                    <div x-show="visibleBgCount < backgrounds.length" class="text-center">
                         <button @click="loadMoreBgs(); playSound('click')" class="text-xs text-pink-500 font-bold border border-pink-200 rounded-full px-4 py-2 hover:bg-pink-50 transition-colors">
                             â¬‡ï¸ è¼‰å…¥æ›´å¤šèƒŒæ™¯
                         </button>
                    </div>
                </div>
            </div>
            <button @click="generateIDCard; playSound('success')" class="w-full py-4 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all active:scale-95 flex items-center justify-center gap-2">
                <span>âœ¨</span> ç”Ÿæˆèº«åˆ†è­‰
            </button>
        </div>

        <div id="idCardTemplate" style="display: none;" class="fixed top-0 left-0 w-[375px] h-[600px] flex-col justify-between rounded-[24px] overflow-hidden font-sans text-white">
            <img :src="selectedBg" class="absolute inset-0 w-full h-full object-cover z-0" crossorigin="anonymous">
            <div class="absolute inset-0 z-10 bg-gradient-to-b from-black/30 via-transparent to-black/90"></div>
            <div class="relative z-20 p-8 pt-12 flex justify-between items-start">
                <img src="./images/basic/icon.png" class="w-16 h-16 rounded-full border-2 border-white/80 shadow-md">
                <div class="text-right">
                    <div class="text-[10px] font-bold tracking-[0.3em] opacity-80 mb-1">OFFICIAL FAN</div>
                    <div class="font-bold text-2xl tracking-widest text-white drop-shadow-lg">éº‹é¹¿èªè­‰</div>
                </div>
            </div>
            <div class="relative z-20 p-8 pb-16">
                <div class="mb-8">
                    <div class="text-[10px] font-bold tracking-[0.2em] opacity-60 mb-1 uppercase">Name</div>
                    <div class="text-5xl font-black tracking-tight drop-shadow-md" x-text="idCardName"></div>
                </div>
                <div class="flex justify-between items-end border-t border-white/30 pt-4">
                    <div><div class="text-[10px] font-bold tracking-[0.2em] opacity-60 mb-1">ID è™Ÿç¢¼</div><div class="text-xl font-mono font-bold tracking-widest" x-text="generatedIdNumber"></div></div>
                    <div class="text-right"><div class="text-[10px] font-bold tracking-[0.2em] opacity-60 mb-1">æ—¥æœŸ</div><div class="text-sm font-mono opacity-90" x-text="new Date().toISOString().split('T')[0]"></div></div>
                </div>
            </div>
            <div class="absolute bottom-4 w-full text-center z-30 opacity-60 text-[10px] tracking-widest text-white font-mono shadow-black drop-shadow-md">
                https://wangleoncom.github.io/ldweb
            </div>
        </div>

        <div id="examPaperTemplate" style="display: none;" class="fixed top-0 left-0 w-[375px] h-[600px] flex-col bg-white overflow-hidden font-sans rounded-[24px]">
            <div class="bg-gradient-to-br from-pink-500 to-rose-600 h-32 relative flex flex-col items-center justify-center shrink-0 z-10">
                <div class="z-10 text-center -mt-4 text-white">
                    <div class="text-[10px] font-bold tracking-[0.4em] mb-1 opacity-90">OFFICIAL EXAM</div>
                    <div class="text-4xl font-black tracking-widest drop-shadow-md">é¹¿ğŸ¦Œå¤§æœƒè€ƒ</div>
                </div>
                <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 w-16 h-16 bg-white rounded-full p-1 border-[5px] border-rose-500 shadow-lg flex items-center justify-center z-20">
                    <span class="text-3xl pb-1">ğŸ“</span>
                </div>
            </div>
            <div class="flex-1 flex flex-col px-6 pt-12 pb-6 w-full relative z-0">
                <div class="absolute inset-0 z-0">
                     <img :src="randomShareBg" class="w-full h-full object-cover object-center opacity-20 filter blur-[2px]" crossorigin="anonymous">
                     <div class="absolute inset-0 bg-white/60"></div>
                </div>
                <div class="relative z-10 flex flex-col h-full">
                    <div class="flex justify-between items-end border-b-2 border-dashed border-gray-300 pb-2 mb-4 shrink-0">
                        <div class="text-gray-500 text-[10px] font-bold tracking-wider">æ—¥æœŸï¼š <span x-text="examDate"></span></div>
                        <div class="font-bold text-base text-gray-800">æˆç¸¾å–®</div>
                    </div>
                    
                    <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-5 mb-6 flex justify-between items-center border border-white shadow-sm">
                        <div class="flex-1 pr-2 min-w-0">
                            <div class="text-[10px] text-gray-400 font-bold tracking-widest mb-1 uppercase">å§“å</div>
                            <div class="font-black text-3xl text-gray-800 break-words leading-tight" x-text="quizTakerName"></div>
                        </div>
                        <div class="text-right pl-4 border-l-2 border-gray-100">
                            <div class="text-[10px] text-gray-400 font-bold tracking-widest mb-1 uppercase">åˆ†æ•¸</div>
                            <div class="font-black text-6xl text-rose-500" x-text="quizScore * 20"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white/80 backdrop-blur-sm border-2 border-rose-100 rounded-xl p-6 mb-4 flex flex-col justify-center items-center shadow-sm flex-1">
                        <div class="text-6xl mb-4 mt-1 transform hover:scale-110 transition-transform" x-text="quizScore === 5 ? 'ğŸ‘‘' : (quizScore >= 3 ? 'ğŸ‘' : 'ğŸ¤¡')"></div>
                        <div class="font-bold text-xl text-gray-800 text-center px-2" x-text="quizScore === 5 ? 'å¤ªç¥å•¦ï¼å®Œç¾å…¨å°ï¼' : (quizScore >= 3 ? 'é‚„ä¸éŒ¯å–”ï¼Œç¹¼çºŒåŠ æ²¹ï¼' : 'è¦å†å»è¤‡ç¿’ QA å–”ï¼')"></div>
                    </div>

                    <div class="w-full text-center mt-auto pt-4 border-t border-dashed border-gray-300">
                        <div class="text-[10px] font-mono tracking-widest text-gray-400">
                            https://wangleoncom.github.io/ldweb
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="shareCardTemplate" style="display: none;" class="fixed top-0 left-0 w-[375px] h-[600px] flex-col items-center justify-center rounded-[24px] overflow-hidden text-center font-sans bg-gray-900">
            <img :src="randomShareBg" class="absolute inset-0 w-full h-full object-cover z-0 opacity-60" crossorigin="anonymous">
            <div class="absolute inset-0 z-10 bg-black/20 backdrop-blur-[4px]"></div>
            <div class="relative z-20 w-full p-8 flex flex-col items-center h-full justify-center">
                <img src="./images/basic/icon.png" class="w-20 h-20 rounded-full border-4 border-white shadow-2xl mb-6 flex-shrink-0">
                <div class="bg-white/95 p-6 rounded-[32px] w-full shadow-2xl backdrop-blur-md border border-white/50 flex flex-col max-h-[400px]">
                    <div class="text-xs font-black text-pink-500 uppercase tracking-widest mb-2 flex-shrink-0">Q: å•é¡Œ</div>
                    <p id="shareCardQ" class="font-bold text-gray-900 mb-4 text-lg leading-snug line-clamp-3"></p>
                    <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-4 flex-shrink-0"></div>
                    <div class="text-xs font-black text-gray-400 uppercase tracking-widest mb-2 flex-shrink-0">A: ç­”æ¡ˆ</div>
                    <p id="shareCardA" class="text-rose-600 font-bold text-2xl leading-relaxed line-clamp-[7] overflow-hidden text-ellipsis"></p>
                </div>
                <div class="mt-8 text-white/80 text-[10px] font-mono tracking-widest border border-white/30 px-4 py-2 rounded-full bg-black/40 flex-shrink-0">
                    https://wangleoncom.github.io/ldweb
                </div>
            </div>
        </div>

        <div x-show="showBgSelectorModal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-6" x-cloak>
            <div class="bg-white rounded-[32px] p-6 max-w-sm w-full animate-blob">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">é¸æ“‡ä¸€å¼µå–œæ­¡çš„ç…§ç‰‡ç•¶èƒŒæ™¯ ğŸ“¸</h3>
                <div class="grid grid-cols-2 gap-3 max-h-[50vh] overflow-y-auto p-1 mb-4">
                    <template x-for="bg in backgrounds" :key="bg">
                        <div @click="confirmExamImage(bg); playSound('click')" class="aspect-[3/4] rounded-xl overflow-hidden cursor-pointer border-4 border-transparent hover:border-pink-500 transition-all shadow-md">
                            <img :src="bg" class="w-full h-full object-cover">
                        </div>
                    </template>
                </div>
                <button @click="showBgSelectorModal = false" class="w-full py-3 bg-gray-100 hover:bg-gray-200 rounded-full font-bold text-gray-500">å–æ¶ˆ</button>
            </div>
        </div>

        <div x-show="showShareModal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md p-6" x-transition.opacity x-cloak>
            <div class="bg-white rounded-[32px] p-6 max-w-sm w-full flex flex-col items-center relative shadow-2xl">
                <div class="absolute -top-12 text-white font-bold text-sm tracking-widest opacity-90 animate-pulse">é•·æŒ‰åœ–ç‰‡å³å¯å„²å­˜ ğŸ“¸</div>
                <div id="shareResultContainer" class="mb-6 shadow-xl rounded-2xl overflow-hidden w-full bg-gray-100 min-h-[300px] flex items-center justify-center"></div>
                <button @click="showShareModal = false; playSound('click')" class="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-full font-bold text-sm transition-colors">é—œé–‰</button>
            </div>
        </div>

        <div x-show="showMsgDetail" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-6" x-transition.opacity x-cloak>
            <div @click.outside="showMsgDetail = false" class="bg-white rounded-[32px] p-6 max-w-sm w-full shadow-2xl relative">
                <button @click="showMsgDetail = false" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800">âœ•</button>
                <h3 class="text-lg font-black text-gray-800 mb-4 flex items-center gap-2">
                    ğŸ¤– AI æ€è€ƒåˆ†æ
                </h3>
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-2xl">
                        <div class="text-xs text-gray-400 font-bold uppercase mb-1">åŒ¹é…åˆ°çš„åŸå§‹å•é¡Œ</div>
                        <p class="font-medium text-gray-800" x-text="selectedMsg.originalQ || 'ç„¡è³‡æ–™'"></p>
                    </div>
                    <div class="flex items-center justify-between bg-pink-50 p-4 rounded-2xl border border-pink-100">
                        <div class="text-xs text-pink-400 font-bold uppercase">ä¿¡å¿ƒ/æº–ç¢ºç‡</div>
                        <div class="font-black text-2xl text-pink-600">
                            <span x-text="selectedMsg.accuracy"></span>%
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 text-center">
                        AI æ˜¯é€éé—œéµå­—æ¨¡ç³Šæœå°‹åŒ¹é…è³‡æ–™åº«ä¸­çš„å•é¡Œã€‚
                    </p>
                </div>
            </div>
        </div>

    </main>

    <footer class="text-center pb-24 text-[10px] text-gray-400 font-medium">
        <p>å¦‚æœç¶²ç«™æœ‰å•é¡Œè«‹è¯çµ¡ç›´æ’­ç®¡ç†å“¡ã€Œç‹å²¦æ©ã€</p>
        <p class="opacity-50 mt-1">Â© 2026 Deer QA System. All rights reserved.</p>
    </footer>

    <script>
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        
        function playTone(freq, type, duration) {
            if(window.isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        window.isMuted = false;
        window.playSound = function(type) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            if(window.isMuted) return;
            
            switch(type) {
                case 'click': playTone(800, 'sine', 0.1); break;
                case 'success': 
                    playTone(600, 'sine', 0.1);
                    setTimeout(() => playTone(900, 'sine', 0.2), 100);
                    break;
                case 'flip': playTone(400, 'triangle', 0.15); break;
                default: playTone(800, 'sine', 0.1);
            }
        };

        function deerApp() {
            return {
                currentTab: 'home',
                isMuted: false,
                search: '',
                isGenerating: false,
                scrollY: 0,

                tabs: [
                    {id: 'home', label: 'é¦–é '},
                    {id: 'ai', label: 'AI èŠå¤©'},
                    {id: 'quiz', label: 'å¤§æœƒè€ƒ'},
                    {id: 'idcard', label: 'èº«åˆ†è­‰'}
                ],

                idCardName: '',
                selectedBg: '', 
                generatedIdNumber: 'D1003' + Math.floor(Math.random()*9000+1000),
                
                backgrounds: [], 
                visibleBgCount: 10, 
                randomShareBg: '',

                // åˆ†é ç›¸é—œ
                qaData: [],
                paginatedData: [],
                currentPage: 1,
                itemsPerPage: 20, // æ¯æ¬¡è¼‰å…¥ 20 é¡Œ
                currentDisplayCount: 20,
                
                flippedCards: [],
                chatInput: '',
                chatHistory: [{ id: 1, text: "å“ˆå›‰ï¼æˆ‘æ˜¯ AI éº‹é¹¿ ğŸ¦Œ\nä½ å¯ä»¥å•æˆ‘ä»»ä½•é—œæ–¼é¹¿ğŸ¦Œçš„å•é¡Œï¼", isUser: false, originalQ: "System", accuracy: 100 }],
                isTyping: false,
                quizStarted: false,
                quizEnded: false,
                quizTakerName: '',
                currentQuizIndex: 0,
                quizScore: 0,
                currentQuizSet: [],
                currentQuestion: null,
                currentOptions: [],
                hasAnswered: false,
                examDate: '',
                showShareModal: false,
                showBgSelectorModal: false,
                selectedMsg: {},
                showMsgDetail: false,

                get displayedBackgrounds() {
                    return this.backgrounds.slice(0, this.visibleBgCount);
                },

                loadMoreBgs() {
                    this.visibleBgCount += 10;
                },
                
                get hasMoreData() {
                    let filtered = this.qaData;
                    if(this.search) filtered = this.fuseInstance.search(this.search).map(r=>r.item);
                    return this.currentDisplayCount < filtered.length;
                },

                initApp() {
                    // QA è³‡æ–™è¼‰å…¥
                    let rawData = window.deerQA_DB || [];
                    this.qaData = rawData.map((item, index) => ({ ...item, id: index + 1 }));
                    this.fuseInstance = new Fuse(this.qaData, { includeScore: true, keys: ['q', 'tags'] });
                    
                    this.examDate = new Date().toLocaleDateString();
            
                    this.updatePaginatedData();
                    
                    this.detectLocalBackgrounds();
                },

                async detectLocalBackgrounds() {
                    const foundBgs = [];
                    const maxChecks = 50; 
                    
                    const checkPromises = [];

                    for(let i = 1; i <= maxChecks; i++) {
                        const path = `./images/backgrounds/bg${i}.jpg`; 
                        const p = new Promise(resolve => {
                            const img = new Image();
                            img.onload = () => resolve(path);
                            img.onerror = () => resolve(null);
                            img.src = path;
                        });
                        checkPromises.push(p);
                    }

                    const results = await Promise.all(checkPromises);
                    const validBgs = results.filter(path => path !== null);

                    if (validBgs.length > 0) {
                        this.backgrounds = validBgs;
                        this.selectedBg = validBgs[0];
                        this.randomShareBg = validBgs[0];
                    } else {
                        console.warn("æœªåµæ¸¬åˆ° images/backgrounds/ å…§çš„åœ–ç‰‡");
                        this.backgrounds = ['./images/basic/icon.png']; 
                        this.selectedBg = this.backgrounds[0];
                    }
                },

                handleScroll() { this.scrollY = window.scrollY; },

                async imageUrlToBase64(url) {
                    try {
                        const res = await fetch(url);
                        const blob = await res.blob();
                        return new Promise(resolve => {
                            const reader = new FileReader();
                            reader.onloadend = () => resolve(reader.result);
                            reader.readAsDataURL(blob);
                        });
                    } catch(e) { return url; }
                },

                async captureElement(elementId, bgUrl) {
                    this.isGenerating = true;
                    const originalShareBg = this.randomShareBg;
                    const originalSelectedBg = this.selectedBg;
                    
                    if(elementId === 'idCardTemplate') this.selectedBg = bgUrl;
                    else this.randomShareBg = bgUrl;

                    // çµ¦ DOM ä¸€é»æ™‚é–“æ¸²æŸ“æ›´æ–°åœ–ç‰‡
                    await new Promise(r => setTimeout(r, 100));

                    const element = document.getElementById(elementId);
                    if(element) {
                        element.style.display = 'flex';
                        try {
                            const canvas = await html2canvas(element, { 
                                useCORS: true, 
                                allowTaint: false, 
                                scale: 2 
                            });
                            const img = canvas.toDataURL("image/png");
                            document.getElementById('shareResultContainer').innerHTML = `<img src="${img}" class="w-full h-full object-contain pointer-events-auto shadow-lg rounded-xl">`;
                            this.showShareModal = true;
                            playSound('success');
                        } catch(e) { 
                            console.error(e);
                            alert("ç”Ÿæˆå¤±æ•—ï¼Œå¦‚æœæ˜¯æœ¬åœ°é–‹å•Ÿè«‹ä½¿ç”¨ Live Server"); 
                        } 
                        finally {
                            element.style.display = 'none';
                            this.randomShareBg = originalShareBg;
                            this.selectedBg = originalSelectedBg;
                            this.isGenerating = false;
                        }
                    }
                },

                changeTab(tab) { this.currentTab = tab; window.scrollTo({top:0, behavior:'smooth'}); if(tab==='quiz') this.quizStarted=false; },
                
                toggleCard(id) {
                    if(this.flippedCards.includes(id)) this.flippedCards = this.flippedCards.filter(cid=>cid!==id);
                    else this.flippedCards.push(id);
                },
                
                loadMoreQA() {
                    // åˆ†é è¼‰å…¥ï¼šå¢åŠ é¡¯ç¤ºæ•¸é‡
                    this.currentDisplayCount += this.itemsPerPage;
                    this.updatePaginatedData();
                },

                updatePaginatedData() {
                    let filtered = this.qaData;
                    if(this.search) filtered = this.fuseInstance.search(this.search).map(r=>r.item);
                    this.paginatedData = filtered.slice(0, this.currentDisplayCount);
                },
                
                filterQA() { 
                    this.currentDisplayCount = this.itemsPerPage;
                    this.updatePaginatedData(); 
                },

                handleEnter(e) {
                    if (e.isComposing || e.keyCode === 229) return;
                    this.sendMessage();
                },

                sendMessage() {
                    if(!this.chatInput.trim()) return;
                    playSound('click');
                    
                    const userText = this.chatInput;
                    this.chatInput = ''; 
                    
                    this.chatHistory.push({id: Date.now(), text: userText, isUser: true});
                    this.isTyping = true;
                    
                    setTimeout(() => {
                        const container = document.getElementById('chatContainer');
                        if(container) container.scrollTop = container.scrollHeight;
                    }, 10);

                    setTimeout(() => {
                        let reply = "æŠ±æ­‰ï¼Œæˆ‘å¥½åƒæ²’è½æ‡‚...ğŸ¤”";
                        let origQ = "ç„¡åŒ¹é…";
                        let acc = 0;
                        const results = this.fuseInstance.search(userText);
                        if(results.length > 0) {
                            const best = results[0];
                            acc = Math.round((1 - best.score) * 100);
                            reply = acc > 40 ? best.item.a : "é›–ç„¶ä¸ç¢ºå®šï¼Œä½†æˆ‘çŒœä½ æƒ³å•ï¼šã€Œ"+best.item.q+"ã€ï¼Ÿ\n"+best.item.a;
                            origQ = best.item.q;
                        }
                        this.isTyping = false;
                        this.chatHistory.push({id: Date.now()+1, text: reply, isUser: false, originalQ: origQ, accuracy: acc});
                        playSound('success');
                        setTimeout(() => {
                            const container = document.getElementById('chatContainer');
                            if(container) container.scrollTop = container.scrollHeight;
                        }, 10);
                    }, 800);
                },
                
                openMsgDetail(msg) { 
                    this.selectedMsg = msg; 
                    this.showMsgDetail = true; // é–‹å•Ÿå½ˆçª—
                    playSound('click'); 
                },

                startQuiz() {
                    if(!this.quizTakerName) { alert("è«‹è¼¸å…¥åå­—ï¼"); return; }
                    
                    const allQuestions = window.deerQuiz_DB || [];
                    if(allQuestions.length < 5) {
                        alert("é¡Œåº«é¡Œç›®ä¸è¶³ 5 é¡Œï¼Œè«‹å¢åŠ é¡Œç›®ï¼");
                        return;
                    }

                    this.quizStarted = true; this.quizEnded = false; this.quizScore = 0; this.currentQuizIndex = 0;
                    // é€™è£¡å¦‚æœè¦æ”¹è€ƒ 20 é¡Œï¼Œé‚è¼¯æ˜¯ä¸€æ¨£çš„ï¼Œä½†å¦‚æœé¡Œåº«å°‘æ–¼ 5 é¡Œæœƒå ±éŒ¯ã€‚
                    // ç‚ºäº†ä¿éšªï¼Œæˆ‘å€‘å–éš¨æ©Ÿ 5 é¡Œï¼ˆå¤§æœƒè€ƒé€šå¸¸é¡Œç›®ä¸å¤šï¼‰ã€‚
                    // å¦‚æœæ‚¨ç¢ºå®šè¦ 20 é¡Œï¼Œè«‹æŠŠ slice(0, 5) æ”¹æˆ slice(0, 20)
                    // ä¸‹æ–¹æˆ‘ç¶­æŒéš¨æ©Ÿ 5 é¡Œæ©Ÿåˆ¶ï¼Œè‹¥è¦æ”¹æ•¸é‡è«‹åœ¨æ­¤ä¿®æ”¹ï¼š
                    this.currentQuizSet = [...allQuestions].sort(()=>0.5-Math.random()).slice(0, 5);
                    this.loadQuestion();
                    playSound('success');
                },
                loadQuestion() {
                    this.currentQuestion = this.currentQuizSet[this.currentQuizIndex];
                    this.currentOptions = [...this.currentQuestion.options].sort(()=>0.5-Math.random());
                    this.hasAnswered = false;
                },
                checkAnswer(opt) {
                    if(this.hasAnswered) return;
                    this.hasAnswered = true; this.selectedOption = opt;
                    if(opt === this.currentQuestion.a) { this.quizScore++; playSound('success'); confetti({origin:{y:0.7}}); }
                },
                nextQuestion() {
                    if(this.currentQuizIndex < this.currentQuizSet.length-1) {
                        this.currentQuizIndex++; this.loadQuestion();
                    } else {
                        this.quizEnded = true;
                        this.showBgSelectorModal = true;
                    }
                },
                
                async confirmExamImage(bgUrl) {
                    this.showBgSelectorModal = false;
                    await this.captureElement('examPaperTemplate', bgUrl);
                },
                async generateIDCard() {
                    if(!this.idCardName) { alert("è«‹è¼¸å…¥æš±ç¨±ï¼"); return; }
                    await this.captureElement('idCardTemplate', this.selectedBg);
                },
                async openShareModal(item) {
                    let bg = this.backgrounds.length > 0 ? this.backgrounds[Math.floor(Math.random()*this.backgrounds.length)] : this.randomShareBg;
                    document.getElementById('shareCardQ').innerText = item.q;
                    document.getElementById('shareCardA').innerText = item.a;
                    await this.captureElement('shareCardTemplate', bg);
                }
            }
        }
    </script>
</body>
</html>
