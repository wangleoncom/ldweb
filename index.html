<!DOCTYPE html>
<html lang="zh-TW" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¹¿ğŸ¦Œçš„ QA æª”æ¡ˆå®¤</title>
    <link rel="icon" href="./icon.png" type="image/png">
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#fdf2f8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Rounded+Mplus+1c:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="./deer_db.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        deer: {
                            50: '#fdf2f8', 100: '#fce7f3', 200: '#fbcfe8', 300: '#f9a8d4', 
                            400: '#f472b6', 500: '#ec4899', 600: '#db2777', 800: '#9d174d', 900: '#831843',
                        }
                    },
                    fontFamily: {
                        sans: ['"Rounded Mplus 1c"', '"Noto Sans TC"', 'sans-serif'],
                    },
                    animation: {
                        'wiggle': 'wiggle 0.2s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'rainbow': 'rainbow 5s linear infinite',
                        'pop-in': 'popIn 0.5s cubic-bezier(0.26, 0.53, 0.74, 1.48) forwards',
                    },
                    keyframes: {
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        rainbow: {
                            '0%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                            '100%': { backgroundPosition: '0% 50%' },
                        },
                        popIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9) translateY(20px)' },
                            '100%': { opacity: '1', transform: 'scale(1) translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        .glass { background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(16px) saturate(180%); -webkit-backdrop-filter: blur(16px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.3); }
        .dark .glass { background: rgba(30, 30, 30, 0.65); border: 1px solid rgba(255, 255, 255, 0.1); }
        .ios-active:active { transform: scale(0.96); transition: transform 0.1s; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .medal-glow { filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6)); }
        .god-mode-bg { background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000); background-size: 400%; animation: rainbow 20s linear infinite; }
    </style>
</head>
<body class="bg-deer-50 text-gray-700 transition-colors duration-300 dark:bg-gray-900 dark:text-gray-100 font-sans min-h-screen selection:bg-deer-300 selection:text-deer-900 overflow-x-hidden"
      :class="{'god-mode-bg': godMode}"
      x-data="deerApp()" x-init="initApp()" @keydown.window="checkKonamiCode($event)"
      @scroll.window="handleScroll">

    <div x-show="!godMode" class="fixed inset-0 overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-deer-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse transition-transform duration-[3s]" :style="`transform: translateY(${scrollY * 0.2}px)`"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse delay-1000 transition-transform duration-[3s]" :style="`transform: translateY(-${scrollY * 0.1}px)`"></div>
    </div>

    <nav class="fixed top-0 w-full z-50 transition-all duration-500 border-b border-transparent"
         :class="scrollY > 50 ? 'glass shadow-sm border-white/20' : 'bg-transparent'">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center cursor-pointer ios-active transition-transform origin-left duration-300" 
                 @click="changeTab('home')"
                 :class="scrollY > 50 ? 'scale-90' : 'scale-100'">
                <img src="./icon.png" class="w-8 h-8 rounded-full mr-2 border border-deer-300 object-cover shadow-sm" @click.stop="triggerEasterEgg('icon')">
                <span class="font-bold text-xl text-deer-600 dark:text-deer-300 hidden sm:block tracking-wide">é¹¿ QA</span>
            </div>
            
            <div class="flex space-x-1 bg-gray-100/50 dark:bg-gray-800/50 p-1 rounded-full backdrop-blur-sm border border-white/20">
                <button @click="changeTab('home')" :class="tabClass('home')">é¦–é </button>
                <button @click="changeTab('ai')" :class="tabClass('ai')">AI</button>
                <button @click="startQuizMode()" :class="tabClass('quiz')">æ¸¬é©—</button>
            </div>
            
            <button @click="toggleDarkMode" class="p-2 rounded-full hover:bg-gray-200/50 dark:hover:bg-gray-700/50 ios-active transition-colors">
                <span x-text="isDark ? 'â˜€ï¸' : 'ğŸŒ™'"></span>
            </button>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto min-h-[80vh]">
        
        <div x-show="showBirthdayCountdown" x-transition:enter="transition ease-out duration-500" x-transition:enter-start="opacity-0 -translate-y-4" x-transition:enter-end="opacity-100 translate-y-0"
             class="mb-6 mx-auto max-w-2xl bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl p-4 text-white shadow-lg flex items-center justify-between animate-float ios-active cursor-default">
            <div class="flex items-center">
                <span class="text-3xl mr-3 filter drop-shadow-md">ğŸ‚</span>
                <div>
                    <div class="font-bold text-lg">é¹¿ğŸ¦Œçš„ç”Ÿæ—¥å¿«åˆ°äº†ï¼</div>
                    <div class="text-sm opacity-90">è·é›¢ 10/03 é‚„æœ‰ <span class="font-black text-yellow-300 text-xl" x-text="birthdayDaysLeft"></span> å¤©</div>
                </div>
            </div>
            <div class="hidden sm:block text-2xl animate-pulse">ğŸ‰</div>
        </div>

        <div x-show="installPrompt" class="mb-6 mx-auto max-w-lg glass p-4 rounded-xl flex items-center justify-between animate-float border border-deer-200">
            <div class="flex items-center">
                <span class="text-2xl mr-3">ğŸ“²</span>
                <div>
                    <div class="font-bold text-deer-700 dark:text-deer-300">ä¸‹è¼‰ App ç‰ˆæœ¬</div>
                    <div class="text-xs text-gray-500">å®‰è£åˆ°æ¡Œé¢ï¼Œé›¢ç·šä¹Ÿèƒ½ç”¨ï¼</div>
                </div>
            </div>
            <button @click="installPWA" class="px-4 py-2 bg-deer-500 text-white rounded-full text-sm font-bold shadow-md hover:bg-deer-600 transition ios-active">å®‰è£</button>
        </div>

        <div x-show="currentTab === 'home'" x-transition.opacity.duration.500ms>
            
            <div class="glass rounded-3xl p-6 mb-8 border-l-4 border-deer-400 flex flex-col md:flex-row items-center gap-6 shadow-xl transform transition duration-100 ease-out origin-top"
                 :style="`opacity: ${Math.max(0, 1 - scrollY / 300)}; transform: scale(${Math.max(0.9, 1 - scrollY / 1000)}) translateY(${scrollY * 0.2}px)`">
                <img src="./icon.png" alt="é¹¿" 
                     class="w-24 h-24 md:w-32 md:h-32 rounded-full object-cover shadow-lg border-4 border-white dark:border-gray-700 cursor-pointer hover:rotate-12 transition-transform duration-500 ios-active"
                     @click="triggerEasterEgg('profile')">
                <div class="flex-1 text-center md:text-left">
                    <h2 class="text-3xl font-bold tracking-tight text-gray-800 dark:text-white">é¹¿ (Walking Deer)</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-2 leading-relaxed font-medium">
                        ğŸ‚ 10/03 å¤©ç§¤åº§ | ğŸ“ 170cm | âš–ï¸ 42kg<br>
                        ğŸˆ è²“å’ªï¼šå“ºåš• (è‹±çŸ­)
                    </p>
                    <div class="flex justify-center md:justify-start gap-3 mt-4">
                        <a href="https://www.tiktok.com/@ld.1003_" target="_blank" class="px-5 py-2 bg-black text-white rounded-full text-sm font-bold hover:scale-105 transition-transform ios-active shadow-lg">TikTok</a>
                        <a href="https://www.instagram.com/ld.1003_/" target="_blank" class="px-5 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full text-sm font-bold hover:scale-105 transition-transform ios-active shadow-lg shadow-pink-500/30">Instagram</a>
                    </div>
                </div>
            </div>

            <div class="sticky top-20 z-40 mb-8 transition-all duration-500 ease-out"
                 :class="scrollY > 150 ? 'pt-2 px-2' : ''">
                <div class="relative max-w-2xl mx-auto transition-all duration-500"
                     :class="scrollY > 150 ? 'shadow-2xl scale-[0.98]' : 'shadow-lg'">
                    <div class="absolute inset-0 rounded-full bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl transition-all duration-500"
                         :class="scrollY > 150 ? 'opacity-100' : 'opacity-80'"></div>
                    <input type="text" x-model="search" @input="currentPage = 1" placeholder="æœå°‹å•é¡Œ... (ä¾‹å¦‚: é¹¿ ç”·å‹)" 
                           class="relative w-full pl-14 pr-6 py-4 rounded-full bg-transparent border-2 border-transparent focus:border-deer-300 focus:ring-0 text-lg transition-all placeholder-gray-400 dark:text-white"
                           :class="scrollY > 150 ? 'py-3 text-base' : 'py-4 text-lg'">
                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-2xl transition-all duration-500"
                          :class="scrollY > 150 ? 'text-xl text-deer-500' : 'text-gray-400'">ğŸ”</span>
                </div>
                <div class="text-center mt-2 text-sm text-gray-500 font-medium transition-opacity duration-300"
                     :class="scrollY > 150 ? 'opacity-0 h-0 overflow-hidden' : 'opacity-100'">
                    <span x-show="search.length > 0">
                        âœ¨ ç©åˆ†æœå°‹ä¸­... æ‰¾åˆ° <span x-text="filteredQuestions.length" class="text-deer-600 font-bold"></span> ç­†
                    </span>
                    <span x-show="search.length === 0">
                        é¡¯ç¤º <span x-text="currentPage"></span> / <span x-text="totalPages"></span> é 
                    </span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 min-h-[400px]">
                <template x-for="(item, index) in paginatedData" :key="item.id">
                    <div class="group h-64 perspective-1000 cursor-pointer animate-pop-in" 
                         :style="`animation-delay: ${index * 50}ms`"
                         @click="toggleCard(item.id)">
                        <div class="relative w-full h-full transform-style-3d transition-all duration-700 shadow-xl hover:shadow-2xl rounded-3xl ios-active"
                             :class="{ 'rotate-y-180': flippedCards.includes(item.id) }">
                            
                            <div class="absolute w-full h-full glass rounded-3xl p-6 flex flex-col justify-between backface-hidden border-t-4 border-deer-300 bg-gradient-to-b from-white/60 to-white/30 dark:from-gray-800/60 dark:to-gray-900/30">
                                <div>
                                    <span class="text-xs font-black text-deer-500 bg-deer-100 dark:bg-deer-900/50 px-3 py-1 rounded-full">Q.<span x-text="item.id"></span></span>
                                    <h3 class="text-lg font-bold mt-3 leading-snug text-gray-800 dark:text-gray-100" x-text="item.q"></h3>
                                    <span x-show="search.length > 0 && item.score > 0" class="text-xs text-pink-500 font-mono mt-2 block bg-pink-50 dark:bg-pink-900/30 w-fit px-2 py-0.5 rounded">
                                        Match Score: <span x-text="item.score"></span>
                                    </span>
                                </div>
                                <div class="flex justify-end items-center text-sm text-gray-400 font-medium group-hover:text-deer-400 transition-colors">
                                    é»æ“Šç¿»ç‰Œ <span class="ml-1 text-lg">ğŸ‘‰</span>
                                </div>
                            </div>

                            <div class="absolute w-full h-full glass rounded-3xl p-6 flex flex-col backface-hidden rotate-y-180 bg-white dark:bg-gray-800 border-b-4 border-purple-400 overflow-y-auto">
                                <div class="flex-1 flex items-center justify-center">
                                    <p class="text-lg font-medium text-center leading-relaxed text-gray-700 dark:text-gray-200" x-text="item.a"></p>
                                </div>
                                <button @click.stop="openShareModal(item)" class="w-full mt-4 flex justify-center items-center gap-2 text-xs text-deer-600 bg-deer-50 dark:bg-deer-900/30 px-4 py-2 rounded-xl font-bold hover:bg-deer-100 transition-colors ios-active">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                                    ç”Ÿæˆç¾åœ–åˆ†äº«
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <div class="flex flex-wrap justify-center items-center mt-12 gap-3 pb-12" x-show="totalPages > 1">
                <button @click="goToPage(1)" :disabled="currentPage === 1" class="px-5 py-2 rounded-full glass font-bold hover:bg-deer-100 disabled:opacity-30 transition ios-active text-xs">|â—€</button>
                <button @click="prevPage" :disabled="currentPage === 1" class="px-5 py-2 rounded-full glass font-bold hover:bg-deer-100 disabled:opacity-30 transition ios-active">â—€</button>
                <span class="font-black text-deer-600 dark:text-deer-300 px-3 text-lg"><span x-text="currentPage"></span> <span class="text-sm font-normal text-gray-400">/</span> <span x-text="totalPages"></span></span>
                <button @click="nextPage" :disabled="currentPage === totalPages" class="px-5 py-2 rounded-full glass font-bold hover:bg-deer-100 disabled:opacity-30 transition ios-active">â–¶</button>
                <button @click="goToPage(totalPages)" :disabled="currentPage === totalPages" class="px-5 py-2 rounded-full glass font-bold hover:bg-deer-100 disabled:opacity-30 transition ios-active text-xs">â–¶|</button>
            </div>
        </div>

        <div x-show="currentTab === 'ai'" x-cloak class="max-w-2xl mx-auto h-[75vh] flex flex-col glass rounded-3xl overflow-hidden shadow-2xl relative border border-white/40">
            <div x-show="aiStatus !== 'online'" class="absolute inset-0 z-20 bg-white/95 dark:bg-gray-900/95 flex flex-col items-center justify-center text-center p-6 transition-opacity duration-500 backdrop-blur-sm">
                <div class="relative group cursor-pointer ios-active" @click="wakeUpAI">
                    <img src="./AI.png" alt="Sleeping AI" class="w-32 h-32 rounded-full object-cover mb-4 border-4 border-gray-300 grayscale opacity-80 transition-all active:scale-95 hover:grayscale-0 hover:opacity-100 shadow-xl" :class="{'animate-wiggle': wakeUpCount > 0}">
                    <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 bg-deer-500 text-white text-xs px-3 py-1 rounded-full whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity shadow-md font-bold">é»æ“Šå«é†’æˆ‘ï¼</div>
                </div>
                <h3 class="text-2xl font-bold mb-2 text-gray-800 dark:text-white">AI å°éº‹é¹¿ç›®å‰...</h3>
                <p class="text-deer-600 text-lg font-bold mb-4" x-text="aiStatusText"></p>
                <p class="text-sm text-gray-400" x-show="wakeUpCount > 0">å†é» <span class="text-red-500 font-bold text-lg" x-text="5 - wakeUpCount"></span> ä¸‹å«ä»–ï¼</p>
            </div>
            
            <div class="bg-white/50 dark:bg-black/30 backdrop-blur-md p-4 flex items-center border-b border-gray-200/50 dark:border-gray-700/50">
                <img src="./AI.png" alt="AI" class="w-10 h-10 rounded-full object-cover mr-3 bg-white p-0.5 shadow-md">
                <div>
                    <h3 class="font-bold text-gray-800 dark:text-gray-100">AI å°éº‹é¹¿</h3>
                    <div class="flex items-center text-xs font-medium">
                        <span class="w-2 h-2 rounded-full mr-1 transition-colors duration-300 shadow-sm" :class="aiStatus === 'online' ? 'bg-green-500 animate-pulse' : 'bg-gray-400'"></span> 
                        <span x-text="aiStatus === 'online' ? 'ç·šä¸Š' : 'å¿™ç¢Œä¸­...'" class="text-gray-500 dark:text-gray-400"></span>
                    </div>
                </div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chatContainer">
                <template x-for="msg in chatHistory" :key="msg.id">
                    <div class="flex w-full animate-pop-in" :class="msg.isUser ? 'justify-end' : 'justify-start'">
                        <div class="max-w-[80%] rounded-2xl px-5 py-3 shadow-md text-sm leading-relaxed" 
                             :class="msg.isUser ? 'bg-gradient-to-br from-deer-500 to-pink-600 text-white rounded-br-none' : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-bl-none'">
                            <p x-text="msg.text" class="whitespace-pre-line"></p>
                            <span class="text-[10px] opacity-70 block text-right mt-1" x-text="msg.time"></span>
                        </div>
                    </div>
                </template>
                <div x-show="isTyping" class="flex justify-start animate-pop-in">
                    <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-bl-none px-4 py-3 flex space-x-1 shadow-sm">
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"></div>
                    </div>
                </div>
            </div>
            
            <div class="p-4 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700">
                <form @submit.prevent="sendMessage" class="flex gap-2">
                    <input type="text" x-model="chatInput" :disabled="aiStatus !== 'online'" placeholder="è¼¸å…¥å•é¡Œ..." class="flex-1 rounded-full bg-gray-100 dark:bg-gray-800 border-transparent focus:border-deer-400 focus:bg-white dark:focus:bg-gray-700 px-5 py-3 transition-all disabled:opacity-50 shadow-inner">
                    <button type="submit" :disabled="aiStatus !== 'online'" class="bg-deer-500 hover:bg-deer-600 text-white rounded-full p-3 w-12 h-12 flex items-center justify-center transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed ios-active">â¤</button>
                </form>
            </div>
        </div>

        <div x-show="currentTab === 'quiz'" x-cloak class="max-w-2xl mx-auto">
            <div x-show="!quizStarted && !quizEnded" class="text-center py-12 glass rounded-3xl p-10 shadow-2xl animate-pop-in">
                <div class="text-8xl mb-6 animate-bounce filter drop-shadow-lg">ğŸ“</div>
                <h2 class="text-3xl font-black mb-4 text-gray-800 dark:text-white">éº‹é¹¿å¤§æœƒè€ƒ 2.0</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-8 font-medium">å…¨å°çš„è©±ï¼Œå°‡é ’ç™¼<br><span class="text-yellow-500 font-bold text-xl">ã€Œé‡‘ç‰Œéº‹é¹¿å‹³ç« ã€</span>ï¼ğŸ¥‡</p>
                <button @click="startQuiz" class="px-10 py-4 bg-gradient-to-r from-deer-400 to-purple-500 text-white rounded-full font-bold text-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all ios-active">æŒ‘æˆ°é–‹å§‹</button>
            </div>
            
            <div x-show="quizStarted && !quizEnded" class="animate-pop-in">
                <div class="flex justify-between items-center mb-6 px-2">
                    <span class="font-bold text-deer-600 bg-deer-100 px-3 py-1 rounded-full text-sm">Q.<span x-text="currentQuizIndex + 1"></span>/5</span>
                    <span class="text-sm font-bold bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-full">åˆ†æ•¸: <span x-text="quizScore"></span></span>
                </div>
                <div class="glass rounded-3xl p-8 mb-6 border-l-4 border-deer-400 min-h-[180px] flex items-center justify-center relative shadow-lg">
                    <h3 class="text-2xl font-bold text-center leading-relaxed text-gray-800 dark:text-white" x-text="currentQuestion?.q || 'è®€å–ä¸­...'"></h3>
                    <div x-show="godMode" class="absolute top-2 right-2 text-xs bg-red-500 text-white px-2 py-1 rounded font-bold animate-pulse">ä¸Šå¸æç¤º: <span x-text="currentQuestion.short || currentQuestion.a"></span></div>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <template x-for="(opt, idx) in currentOptions" :key="idx">
                        <button @click="checkAnswer(opt)" :disabled="hasAnswered" :class="getOptionClass(opt)" class="w-full p-5 rounded-2xl text-left font-bold transition-all transform active:scale-95 border-2 shadow-sm flex items-center justify-between group">
                            <div class="flex items-center">
                                <span class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-sm mr-4 group-hover:bg-deer-100 transition-colors" x-text="['A','B','C','D'][idx]"></span>
                                <span x-text="opt"></span>
                            </div>
                            <span x-show="hasAnswered && opt === currentCorrectText" class="text-green-600 text-xl">âœ…</span>
                            <span x-show="hasAnswered && opt !== currentCorrectText && selectedOption === opt" class="text-red-500 text-xl">âŒ</span>
                        </button>
                    </template>
                </div>
                <button x-show="hasAnswered" @click="nextQuestion" class="mt-8 w-full py-4 bg-gray-800 dark:bg-gray-700 text-white rounded-2xl font-bold shadow-lg hover:scale-[1.02] transition-transform ios-active"><span x-text="currentQuizIndex < 4 ? 'ä¸‹ä¸€é¡Œ âœ' : 'çœ‹çµæœ ğŸ†'"></span></button>
            </div>
            
            <div x-show="quizEnded" class="text-center py-12 glass rounded-3xl p-10 shadow-2xl relative overflow-hidden animate-pop-in">
                <div x-show="quizScore === 5" class="mb-6 relative z-10">
                    <img src="./é‡‘ç‰Œ.png" alt="é‡‘ç‰Œ" class="w-56 h-56 mx-auto object-contain animate-bounce medal-glow">
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-yellow-400 opacity-20 blur-3xl rounded-full -z-10 animate-pulse"></div>
                    <div class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-500 to-orange-500 mt-6">æ­å–œç²å¾—ã€Œé‡‘ç‰Œéº‹é¹¿å‹³ç« ã€</div>
                </div>
                <div x-show="quizScore < 5" class="text-8xl mb-6 transform hover:scale-110 transition-transform cursor-default"><span x-text="quizScore >= 3 ? 'ğŸ¥ˆ' : 'ğŸ¤¡'"></span></div>
                <h2 class="text-5xl font-black text-gray-800 dark:text-white mb-2 tracking-tighter">å¾—åˆ†ï¼š<span x-text="quizScore * 20" class="text-deer-500"></span></h2>
                <div class="flex gap-4 justify-center mt-10">
                    <button @click="startQuiz" class="px-8 py-3 bg-gray-200 dark:bg-gray-700 rounded-full font-bold ios-active hover:bg-gray-300 transition">å†æ¸¬ä¸€æ¬¡</button>
                    <button @click="shareResult" class="px-8 py-3 bg-deer-500 text-white rounded-full font-bold shadow-lg ios-active hover:bg-deer-600 transition">åˆ†äº«æˆç¸¾</button>
                </div>
            </div>
        </div>

        <div id="shareCardTemplate" class="fixed top-0 left-[-9999px] w-[320px] h-[500px] bg-gradient-to-br from-pink-50 to-purple-100 p-6 flex flex-col items-center justify-center text-center rounded-xl border-[12px] border-white">
            <div class="w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg mb-6">
                <img src="./icon.png" class="w-full h-full object-cover">
            </div>
            <h3 class="text-xl font-black text-gray-800 mb-2 tracking-wide">é¹¿çš„å°ç§˜å¯† <span class="text-deer-500">Q.<span id="shareCardId"></span></span></h3>
            <div class="bg-white/90 p-6 rounded-2xl w-full mb-6 shadow-sm border border-pink-100/50">
                <p id="shareCardQ" class="font-bold text-deer-600 mb-3 text-xl leading-snug"></p>
                <div class="w-10 h-1 bg-gray-100 rounded-full mx-auto mb-3"></div>
                <p id="shareCardA" class="text-gray-700 font-medium text-lg"></p>
            </div>
            <div class="mt-auto text-xs text-gray-400 font-mono flex items-center">
                <span class="mr-1">âœ¨</span> deer-qa-system.github.io
            </div>
        </div>

        <div x-show="showShareModal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 p-6 backdrop-blur-sm" x-cloak x-transition.opacity>
            <div class="bg-white rounded-3xl p-6 max-w-sm w-full flex flex-col items-center animate-pop-in">
                <h3 class="font-bold text-gray-800 mb-4 text-lg">é•·æŒ‰åœ–ç‰‡å„²å­˜åˆ†äº« ğŸ“¸</h3>
                <div id="shareResultContainer" class="mb-6 shadow-2xl rounded-xl overflow-hidden border-4 border-gray-100"></div>
                <button @click="showShareModal = false" class="px-8 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full font-bold text-sm transition-colors ios-active">é—œé–‰</button>
            </div>
        </div>

        <div x-show="showVersionModal" x-transition.opacity class="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm" x-cloak>
            <div class="bg-white dark:bg-gray-800 rounded-3xl max-w-md w-full p-8 shadow-2xl relative border-4 border-deer-200 animate-pop-in">
                <div class="absolute -top-12 -right-8 text-7xl animate-bounce hidden md:block filter drop-shadow-lg">ğŸ‰</div>
                <h2 class="text-3xl font-black mb-6 text-deer-600 dark:text-deer-300 tracking-tight">æª”æ¡ˆå®¤å‡ç´šå•¦ï¼ <span class="text-lg font-normal bg-deer-100 px-2 py-1 rounded text-deer-600">v<span x-text="appVersion"></span></span></h2>
                <ul class="space-y-4 text-gray-600 dark:text-gray-300 mb-8 text-base">
                    <template x-for="update in updateLogs" :key="update">
                        <li class="flex items-start">
                            <span class="mr-3 text-deer-500 text-xl">âœ¨</span>
                            <span x-text="update" class="font-medium leading-relaxed"></span>
                        </li>
                    </template>
                </ul>
                <button @click="closeVersionModal" class="w-full py-4 bg-gradient-to-r from-deer-500 to-pink-600 text-white rounded-2xl font-bold shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all ios-active">æˆ‘çŸ¥é“äº†ï¼é–‹å§‹æ¢ç´¢ ğŸš€</button>
            </div>
        </div>

        <div x-show="showToast" x-transition class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-black/80 backdrop-blur text-white px-6 py-3 rounded-full text-sm z-50 shadow-xl font-bold flex items-center"><span class="mr-2">âœ…</span> <span x-text="toastMessage"></span></div>
        <button x-show="showScrollTop" @click="window.scrollTo({top: 0, behavior: 'smooth'})" x-transition class="fixed bottom-8 right-6 p-4 bg-deer-500 text-white rounded-full shadow-lg z-40 hover:bg-deer-600 transition-all hover:scale-110 active:scale-95">â¬†</button>

    </main>

    <footer class="text-center py-10 text-gray-400 text-sm font-medium"><p>Â© 2025 é¹¿ğŸ¦Œçš„ QA æª”æ¡ˆå®¤ | Made for éº‹é¹¿å€‘ â¤ï¸</p></footer>

    <script>
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW fail', err)); }); }

        function deerApp() {
            return {
                allData: window.DEER_QA || [],
                search: '',
                currentTab: 'home',
                isDark: false,
                flippedCards: [],
                showToast: false,
                toastMessage: '',
                scrollY: 0, // æ–°å¢ï¼šæ»¾å‹•åµæ¸¬
                
                installPrompt: null,
                showScrollTop: false,
                appVersion: '3.1.0', // æ›´æ–°ç‰ˆæœ¬è™Ÿï¼šiOS é¢¨æ ¼å¤§æ”¹ç‰ˆ
                showVersionModal: false,
                updateLogs: ["UI å…¨é¢å‡ç´šï¼šiOS é¢¨æ ¼æœå‡å‹•ç•«èˆ‡æ¯›ç»ç’ƒç‰¹æ•ˆ ğŸ", "æ–°å¢å‹•æ…‹æœå°‹æ¬„ï¼šæ»¾å‹•æ™‚æœƒè‡ªå‹•è®Šå½¢å¸é™„ ğŸ”", "æ–°å¢æ»¾å‹•è¦–å·®ï¼šå€‹äººæª”æ¡ˆå¡ç‰‡æ›´æœ‰å±¤æ¬¡æ„Ÿ âœ¨", "å„ªåŒ–è§¸æ§å›é¥‹ï¼šé»æ“ŠæŒ‰éˆ•æœ‰ç‰©ç†å›å½ˆæ„Ÿ ğŸ‘†"],

                currentPage: 1,
                itemsPerPage: 30,

                aiStatus: 'offline', aiStatusText: 'ä¼‘æ¯ä¸­', wakeUpCount: 0,
                showBirthdayCountdown: false, birthdayDaysLeft: 0,
                showShareModal: false,
                godMode: false, konamiCode: ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'], konamiIndex: 0,

                initApp() {
                    if (!this.allData || this.allData.length === 0) console.error("Error: DB not found");
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) this.toggleDarkMode();
                    const savedVersion = localStorage.getItem('deer_app_version');
                    if (savedVersion !== this.appVersion) this.showVersionModal = true;
                    window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); this.installPrompt = e; });
                    this.checkBirthday();
                },

                handleScroll() {
                    this.scrollY = window.scrollY;
                    this.showScrollTop = this.scrollY > 300;
                },

                // (å…¶é¤˜é‚è¼¯ä¿æŒä¸è®Šï¼Œç‚ºäº†ç¯€çœç©ºé–“ç•¥éï¼Œè«‹ç›´æ¥ä½¿ç”¨åŸæœ‰é‚è¼¯)
                checkKonamiCode(e) { if (e.key === this.konamiCode[this.konamiIndex]) { this.konamiIndex++; if (this.konamiIndex === this.konamiCode.length) { this.activateGodMode(); this.konamiIndex = 0; } } else { this.konamiIndex = 0; } },
                activateGodMode() { this.godMode = !this.godMode; this.showNotification(this.godMode ? "ğŸ¤« ä¸Šå¸æ¨¡å¼å·²é–‹å•Ÿï¼" : "ä¸Šå¸æ¨¡å¼å·²é—œé–‰"); confetti({ particleCount: 200, spread: 180 }); },
                checkBirthday() { const today = new Date(); const currentYear = today.getFullYear(); let target = new Date(`${currentYear}-10-03`); if (today > target) target = new Date(`${currentYear + 1}-10-03`); const diff = target - today; const days = Math.ceil(diff / (1000 * 60 * 60 * 24)); if (days <= 30 && days >= 0) { this.showBirthdayCountdown = true; this.birthdayDaysLeft = days; } },
                openShareModal(item) { document.getElementById('shareCardId').innerText = item.id; document.getElementById('shareCardQ').innerText = item.q; document.getElementById('shareCardA').innerText = item.short || item.a; const el = document.getElementById('shareCardTemplate'); html2canvas(el, { backgroundColor: null }).then(canvas => { const container = document.getElementById('shareResultContainer'); container.innerHTML = ''; canvas.style.width = '100%'; canvas.style.height = 'auto'; container.appendChild(canvas); this.showShareModal = true; }); },
                closeVersionModal() { this.showVersionModal = false; localStorage.setItem('deer_app_version', this.appVersion); },
                async installPWA() { if (this.installPrompt) { this.installPrompt.prompt(); const { outcome } = await this.installPrompt.userChoice; if (outcome === 'accepted') this.installPrompt = null; } },
                get filteredQuestions() { if (!this.allData) return []; if (this.search.trim() === '') return this.allData; const searchChars = this.search.toLowerCase().split('').filter(c => c.trim() !== ''); return this.allData.map(item => { let score = 0; const fullText = (item.q + item.a).toLowerCase(); searchChars.forEach(char => { if (fullText.includes(char)) score += 10; }); if (item.q.toLowerCase().includes(this.search.toLowerCase())) score += 50; if (this.search === 'é¹¿å¥½ç¾' && item.id === 1) score += 999; if (this.godMode) score *= 2; return { ...item, score }; }).filter(item => item.score > 0).sort((a, b) => b.score - a.score); },
                get totalPages() { return Math.ceil(this.filteredQuestions.length / this.itemsPerPage); },
                get paginatedData() { const start = (this.currentPage - 1) * this.itemsPerPage; return this.filteredQuestions.slice(start, start + this.itemsPerPage); },
                nextPage() { if (this.currentPage < this.totalPages) { this.currentPage++; window.scrollTo({top: 0, behavior: 'smooth'}); } },
                prevPage() { if (this.currentPage > 1) { this.currentPage--; window.scrollTo({top: 0, behavior: 'smooth'}); } },
                goToPage(page) { this.currentPage = page; window.scrollTo({top: 0, behavior: 'smooth'}); },
                changeTab(tab) { this.currentTab = tab; window.scrollTo({top: 0, behavior: 'smooth'}); if(tab === 'ai') { this.wakeUpCount = 0; if (Math.random() > 0.3) { this.aiStatus = 'offline'; const statuses = ['å‘¼å‘¼å¤§ç¡ä¸­... ğŸ˜´', 'æ­£åœ¨ç›´æ’­ï¼å¿«ä¾†çœ‹ ğŸ¥', 'æ­£åœ¨æ‰“å‚³èªª (ç’€ç’¨å ´å‹¿æ“¾) ğŸ®', 'å»åƒä¸‰è‰²è±†èŠ±å¸ƒä¸äº† ğŸ®', 'è¢«å“ºåš•è¸©åœ¨éµç›¤ä¸Š ğŸˆ', 'æ­£åœ¨ç·´ BLACKPINK çš„èˆ ğŸ’ƒ']; this.aiStatusText = statuses[Math.floor(Math.random() * statuses.length)]; } else { this.aiStatus = 'online'; } } },
                wakeUpAI() { if (this.aiStatus === 'online') return; this.wakeUpCount++; if (this.wakeUpCount >= 5) { this.aiStatus = 'online'; this.addBotMessage("å¥½å•¦å¥½å•¦ï¼è¢«ä½ åµé†’äº†ï¼ğŸ˜  èªªå§ï¼"); this.wakeUpCount = 0; confetti({ particleCount: 30, spread: 50, origin: { y: 0.5 } }); } },
                eggCount: 0, triggerEasterEgg(type) { if (type === 'icon') this.showNotification("ğŸŒˆ é€™æ˜¯ç§˜å¯†é€šé“å—ï¼Ÿ"); if (type === 'profile') { this.eggCount++; if (this.eggCount === 5) { confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); this.showNotification("ğŸ‰ æ­å–œç™¼ç¾éš±è—å½©è›‹ï¼šç˜‹ç‹‚é»æ“Šï¼"); this.eggCount = 0; } } },
                chatInput: '', chatHistory: [], isTyping: false, sendMessage() { if (!this.chatInput.trim()) return; const userText = this.chatInput; this.chatHistory.push({ id: Date.now(), text: userText, isUser: true, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) }); this.chatInput = ''; this.$nextTick(() => { document.getElementById('chatContainer').scrollTop = 99999; }); this.isTyping = true; setTimeout(() => { this.isTyping = false; const reply = this.getSmartAIResponse(userText); this.addBotMessage(reply); }, 800 + Math.random() * 500); },
                getSmartAIResponse(input) { if (!this.allData) return "è³‡æ–™åº«è®€å–å¤±æ•— ğŸ˜µ"; const text = input.toLowerCase(); let keywords = text.split(''); if (text.includes("å¹¾æ­²")) keywords.push("å¹´é½¡", "ç”Ÿæ—¥"); if (text.includes("å“ªè£¡äºº")) keywords.push("ä½", "å®¶é„‰"); if (text.includes("æ„›")) keywords.push("å–œæ­¡", "ç”·å‹"); const candidates = this.allData.map(item => { let score = 0; const qText = item.q.toLowerCase(); keywords.forEach(k => { if(qText.includes(k)) score += 10; }); if (qText.includes(text)) score += 50; return { ...item, score }; }).sort((a, b) => b.score - a.score); const bestMatch = candidates[0]; if (text.includes("ä½ å¥½") || text.includes("å—¨")) return "ä½ å¥½å‘€ï¼æˆ‘æ˜¯æœ€è°æ˜çš„ AI å°éº‹é¹¿ï¼Œæœ‰å•é¡Œéƒ½å¯ä»¥å•æˆ‘ï¼"; if (text.includes("ç¬¨")) return "æˆ‘æ‰ä¸ç¬¨ï¼æˆ‘å¯æ˜¯è¨˜å¾— 100 å¤šæ¢é¹¿çš„è³‡æ–™å‘¢ğŸ˜¤"; if (text.includes("å½©è›‹")) return "å½©è›‹è—åœ¨... é ­åƒè£¡ï¼Ÿè©¦è‘—é»é»çœ‹ï¼ŸğŸ¤«"; if (!bestMatch || bestMatch.score < 5) { const fallbacks = ["é€™å€‹å•é¡Œ... æª”æ¡ˆå®¤è£¡å¥½åƒæ²’æœ‰ç´€éŒ„è€¶ ğŸ¤”", "å—¯... é¹¿æœ¬äººå¯èƒ½æ‰çŸ¥é“å–”ï¼", "é€™é¡Œè¶…ç¶±äº†ï¼ä½ è¦ä¸è¦å»ç›´æ’­å•å•ï¼Ÿ"]; return fallbacks[Math.floor(Math.random() * fallbacks.length)]; } return `é—œæ–¼ã€Œ${bestMatch.q}ã€...\n${bestMatch.a}`; },
                addBotMessage(text) { this.chatHistory.push({ id: Date.now(), text: text, isUser: false, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) }); this.$nextTick(() => { document.getElementById('chatContainer').scrollTop = 99999; }); },
                tabClass(tab) { const active = "bg-white/80 dark:bg-gray-600 text-deer-600 dark:text-deer-300 shadow-md"; const inactive = "text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"; return `px-4 py-1.5 rounded-full text-sm font-bold transition-all duration-300 ${this.currentTab === tab ? active : inactive}`; },
                toggleDarkMode() { this.isDark = !this.isDark; document.documentElement.classList.toggle('dark', this.isDark); },
                toggleCard(id) { if (this.flippedCards.includes(id)) this.flippedCards = this.flippedCards.filter(cid => cid !== id); else this.flippedCards.push(id); },
                showNotification(msg) { this.toastMessage = msg; this.showToast = true; setTimeout(() => this.showToast = false, 3000); },
                quizStarted: false, quizEnded: false, quizData: [], currentQuizIndex: 0, currentOptions: [], hasAnswered: false, selectedOption: null, quizScore: 0, currentCorrectText: '',
                startQuizMode() { this.changeTab('quiz'); this.quizStarted = false; this.quizEnded = false; },
                startQuiz() { if (!this.allData || this.allData.length < 5) { alert("è³‡æ–™ä¸è¶³"); return; } const shuffled = [...this.allData].sort(() => 0.5 - Math.random()); this.quizData = shuffled.slice(0, 5); this.currentQuizIndex = 0; this.quizScore = 0; this.quizStarted = true; this.quizEnded = false; this.prepareQuestion(); },
                get currentQuestion() { return this.quizData[this.currentQuizIndex] || { q: '', a: '' }; },
                prepareQuestion() { this.hasAnswered = false; this.selectedOption = null; const correctOption = this.currentQuestion.short || this.currentQuestion.a; const wrongPool = this.allData.filter(i => i.id !== this.currentQuestion.id).map(i => i.short || i.a); const wrongOptions = wrongPool.sort(() => 0.5 - Math.random()).slice(0, 3); this.currentOptions = [correctOption, ...wrongOptions].sort(() => 0.5 - Math.random()); this.currentCorrectText = correctOption; },
                checkAnswer(option) { if (this.hasAnswered) return; this.hasAnswered = true; this.selectedOption = option; if (option === this.currentCorrectText) { this.quizScore++; confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 }, colors: ['#ec4899', '#db2777'] }); } },
                getOptionClass(option) { if (!this.hasAnswered) return "bg-white dark:bg-gray-800 hover:bg-deer-50 border-gray-100 dark:border-gray-600"; if (option === this.currentCorrectText) return "bg-green-100 border-green-500 text-green-800 shadow-md transform scale-105"; if (option === this.selectedOption) return "bg-red-100 border-red-500 text-red-800"; return "bg-gray-100 opacity-50 border-transparent"; },
                nextQuestion() { if (this.currentQuizIndex < 4) { this.currentQuizIndex++; this.prepareQuestion(); } else { this.quizEnded = true; if(this.quizScore === 5) this.triggerGoldMedalEffect(); } },
                triggerGoldMedalEffect() { var duration = 3 * 1000; var animationEnd = Date.now() + duration; var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 }; var random = function(min, max) { return Math.random() * (max - min) + min; }; var interval = setInterval(function() { var timeLeft = animationEnd - Date.now(); if (timeLeft <= 0) { return clearInterval(interval); } var particleCount = 50 * (timeLeft / duration); confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } })); confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } })); }, 250); },
                shareResult() { const text = `æˆ‘åœ¨ã€Œé¹¿ğŸ¦Œçš„ QA æª”æ¡ˆå®¤ã€æ¸¬é©—æ‹¿äº† ${this.quizScore * 20} åˆ†ï¼\n${this.quizScore === 5 ? 'ğŸ† ç²å¾—é‡‘ç‰Œéº‹é¹¿å‹³ç« ï¼' : 'å¿«ä¾†æŒ‘æˆ°çœ‹çœ‹ï¼'}`; navigator.clipboard.writeText(text).then(() => this.showNotification("âœ… å·²è¤‡è£½æˆç¸¾ï¼")); }
            }
        }
    </script>
</body>
</html>